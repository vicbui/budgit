<!DOCTYPE html>
<html>
	<head>
		<title>My Page</title>
			<meta name="viewport" content="width=device-width, initial-scale=1">
			<link rel="stylesheet" href="http://code.jquery.com/mobile/1.2.0/jquery.mobile-1.2.0.min.css" />
			<script src="js/jquery.js"></script>
			<script src="js/jquerymobile.js"></script>	
			<script type="text/javascript" src="cordova-2.1.0.js"></script>
			<script type="text/javascript" src="js/index.js"></script>
			<script src='js/swipe.js' type="text/javascript"></script>


			<link rel="stylesheet" href="css/index.css" type="text/css" />
			<link rel="stylesheet" href="css/style.css" type="text/css"/>


			<link href="css/jquery.jqplot.css" rel="stylesheet" type="text/css" />
			<link href="css/mobiscroll.css" rel="stylesheet" type="text/css" />

			<script type="text/javascript">
            
				// alert("test");
				
				$.support.cors = true;
				$.mobile.allowCrossDomainPages = true;
				var search_results=new Array();
				var cat=new Array();
				var str="";
				var search_results=new Object();
				
				var lastdate=new Date("1001/01/01");
				var db ;
				var cats=new Array();
				var timer;
    			var symbols= new Object();
    			var transactionDate = new Object();
				var last_word,symbol="$";
				var trackDecimal=0;
				var date_pending=new Object();
				var afternumber;
				var plot; 
				var current_page=1;
				var itemPerLoad=5;
				var all_cat_static;
			
				
         // document.addEventListener("deviceready", onDeviceReady, false);
    
           // $(document).bind('deviceready',function()
		 //function onDeviceReady()
            {
            
				$('#suggestions').bind('pageinit', function() {
 						//$('#suggestions').listview();    						
						setListDefault();

							//.hide();
					
				});
				/****generate list function*****************/
				function addResultToList (db,transactions2,name,itemPerLoad,day,month,year,contextObject)
						{
											//alert("test");
											transactions2=new Object();
											transactions2.results= new Array();

											var now = new Date();
											
											if (day.length == 1 && day!="-1")
										   	{
										   		day = "0" + day;
										   	}
										   	else 
										   		day="01";
										   
										   	if (month.length==1)
										   		month="0"+month;
											
											var firstday = year+ "-" + month+ "-"+day;
											var lastday= year+"-"+month+ "-"+noDaysInMonth(month,year);
											
											if (((now.getMonth()+1)== month) && (now.getFullYear()==year))
											{
												lastday =  year+"-"+month+"-"+now.getDate();
											}
											//alert(firstday+" "+lastday);
											//alert(firstday+" "+lastday);
											listTrans(db,firstday,lastday, function(trans){
												//alert(trans.length);
												if (name=="")
														name="%";

												for (var i=0;i< trans.length; i++)
												{
														
													if (((trans[i].name==name) && (name!="%")) || (name=="%"))
													{

														if (typeof transactions2.results[trans[i].current_date] ==="undefined" )	
															transactions2.results[trans[i].current_date]=new Array();
															transactions2.results[trans[i].current_date].push(trans[i]);
														//console.log(trans[i].current_date+" "+trans[i].name+" "+trans[i].amount);
													
													}
												}
												var results= new Array();
												for (var date in transactions2.results)
												{
													obj=new Object();
													obj.date=date;
													obj.trans=transactions2.results[date];
													var amount=0;
													for (var j=0;j<transactions2.results[date].length;j++)
													{
														amount=amount+Math.abs(transactions2.results[date][j].amount);
													}
													obj.amount=amount;
													results.push(obj);
												
												}
												results.sort(function(a,b) { return  b.date -a.date} );
												//alert(results[0].date);
												$(contextObject).find(".list").html("");
												$(contextObject).find(".list").collapsibleset();

												//console.log("init collapse")
												for (var i=0;i<results.length;i++)
												{
													//console.log(results[i].date+" "+results[i].trans.length);
													var aDate=convertUnixToString(results[i].date);
													var idName='collapse'+i+'page'+current_page+'';
													var str='<div data-role="collapsible">'+
																	'<h2 data-icon="false">'+
																		'<span style="float:left">'+formatDate(aDate)+'</span>'+
																		'<span style="float:right" class="pricecollapse'+i+'page'+current_page+'"></span>'+
																	'</h2>'+	
																	'<span style="float:left" class="dateSelected">'+aDate+'</span>'+
																	'<ul class="collapse'+i+'page'+current_page+'"data-role="listview"></ul></div>'
																	
													//console.log(str);
													$(contextObject).find(".list").append(str);
													$(contextObject).find(".list").collapsibleset("refresh");
													$(contextObject).find(".price"+idName).text("$"+results[i].amount);
													var string="";
													for (var ii in results[i].trans)
													{
														//console.log(results[i].trans[ii].id);
														var optional="<br>"+results[i].trans[ii].optional;
														string+= '<li class="itemDetails" data-icon="false" style="overflow:hidden;font-size:11px;color:gray">';
														string+= '<span style="float:left">'+ capitaliseFirstLetter(results[i].trans[ii].name)+optional+'</span><span id="transId" style="display:none">'+results[i].trans[ii].id+"id"+i+'</span>';
														string+= '<span valign="top" style="float:right">$'+Math.abs(results[i].trans[ii].amount)+'<div id="edit_delete'+results[i].trans[ii].id+"id"+i+'" class="edit_delete" style="padding-left:5px;display:none;float:right">test</div></span>';
														string+= '</li>'
													
													//	$('.edit_delete'+alltrans.results[i].transid)

													}

													$(contextObject).find("."+idName).html(string);
													$(contextObject).find("."+idName).listview();
													$(contextObject).find("."+idName).listview("refresh");
												

												}

												//console.log($("#transDetails").html());

											/***********************************/	
												$('html').click(function() {
												 //Hide the menus if visible
												 	//alert("Test");
												 	$(".edit_delete").hide();
												 });
												function refreshTransDetails()
												{



															var transactions2=new Object();
															transactions2.results= new Array();
															window.localStorage.setItem('current_page',1);

															var contextObject=window.localStorage.getItem('contextObject');
															//alert(contextObject);
															var list=$(contextObject).find(".list");
															list.html("");

															$(contextObject).find(".list").parent().find(".end").remove();

															//addResultToList(db,transactions2,"",itemPerLoad,contextObject);
																								

														var contextObject=window.localStorage.getItem('contextObject')
														var popup="";
														if (contextObject=="#transDetails")
														{
															addResultToList(db,transactions2,"",itemPerLoad,-1,now.getMonth()+1+"",now.getFullYear(),contextObject);
														}
														else
															if (contextObject=="#cat")
															{
																var data=JSON.parse(window.localStorage.getItem("cat"));
																addResultToList(db,transactions2,data.catName,itemPerLoad,data.day,data.month,data.year,contextObject)
															}
															
												}
												$('.recurringDelete').click(function(e){
													//console.log($("#deleteTransDate").text())
													var str=$(this).parent().find("#deleteTransId").text();
													var transid=str.substring(0,str.indexOf("i"));
													var deleteDate=$(this).parent().find("#deleteTransDate").text();
													//alert(deleteDate);

													if ($(this).attr("id")=="0")
													{
														//alert(transid+" "+deleteDate);
														db.transaction(function(db)
														{

															delete_just_this_trans_by_id(db,transid,deleteDate,0);

													 		//addResultToList(db,transactions2,data.catName,itemPerLoad,data.day,data.month,data.year,contextObject);
													 		

														},errorDB,function(){
															//alert("finish");
															
															refreshTransDetails();

															//initTransDetails();
														});				
																		   		

													}
													else
														if ($(this).attr("id")=="1")
														{
															db.transaction(function(db)
															{

																delete_just_this_trans_by_id(db,transid,deleteDate,1);

														 		//addResultToList(db,transactions2,data.catName,itemPerLoad,data.day,data.month,data.year,contextObject);
														 		

															},errorDB,function(){
																//alert("finish");
																
																refreshTransDetails();

																//initTransDetails();
															});			
														}
														else
															if ($(this).attr("id")=="2")
															{
																db.transaction(function(db)
																{

																	 delete_all_repeat_by_id(db,transid);

														 		//addResultToList(db,transactions2,data.catName,itemPerLoad,data.day,data.month,data.year,contextObject);
														 		
																},errorDB,function(){															
																	refreshTransDetails();

																	//initTransDetails();
																});			
															}
															else
																if ($(this).attr("id")=="3")
																{

																}

													$('#popupDelete').popup('close');
													e.preventDefault();
													e.stopImmediatePropagation();
												})
											/***********************************/
													$('.itemDetails').bind("click",function(event1){
														event1.preventDefault();
														var contextObject=window.localStorage.getItem('contextObject')
														var popup="";
												
														//alert($(this).html());
														var transid=$(this).find("#transId").text();
														//alert(selectedDate);
														//var transid=$(this).parent().find("#transId").text();
														//alert(transid);
														var deleteObj=$(this).find('#edit_delete'+transid);
															if ( typeof deleteObj.find('.delete').html() === "undefined" )
															{
																
																deleteObj.show();
																deleteObj.html('<a class="delete"><img src="img/delete.png" alt="delete" width="12px" height="12px" style="margin-top:0px"/></a>');

																deleteObj.bind("click",function(event1){
																			var transactions2=new Object();
																			transactions2.results= new Array();	
																		//	alert($(this).parent().parent().html());				
																			$("#"+popup).popup();
																			$("#"+popup).popup("open",{transition:'slidedown'});
																			
														var transid=$(this).parent().parent().find("#transId").text();
														var selectedDate=$(this).parent().parent().parent().parent().find(".dateSelected").html();

														if (contextObject=="#transDetails")
														{
															popup="popupDelete";
																$("#popupDelete").find("#deleteTransDate").text(selectedDate);
																$("#popupDelete").find("#deleteTransId").text(transid);
																$("#popupDelete").find("#deleteTransDate").hide();
														}
														else
															if (contextObject=="#cat")
															{
																popup="popupDeleteCat";
																$("#popupDeleteCat").find("#deleteTransDate").text(selectedDate);
																$("#popupDeleteCat").find("#deleteTransId").text(transid);
																$("#popupDeleteCat").find("#deleteTransDate").hide();
															}
																		//alert(selectedDate);
																	
																			//alert(transid);
																			/*db.transaction(function(db)
														 				   	{
														 				   		delete_trans_by_id(db,transid);
														 						
														 					},errorDB,function()
														 				    		  { 
														 				    		  		window.localStorage.setItem("current_page",1);

																							var data=JSON.parse(window.localStorage.getItem("cat"));
																							
																							var itemPerLoad=window.localStorage.getItem('itemPerLoad');
																							offset=0,limit=0;
																							var contextObject=$("#cat");	
																							contextObject.find(".list").html("");
																							contextObject.find(".list").parent().find(".end").remove();
															 				    		  	
															 				    		  	addResultToList(db,transactions2,data.catName,itemPerLoad,data.day,data.month,data.year,contextObject);



														 				    		  });*/
																	});	
																}
															else{
																	deleteObj.hide();
																	deleteObj.html("");
															}												


														event1.stopPropagation();
														return false;

													});

											});

											/*db.transaction(function(db)
									 		{
								 	  		    var current_page=window.localStorage.getItem("current_page");
									 			var offset=itemPerLoad*(current_page-1);
									 			//alert(current_page+" "+itemPerLoad);
									 			var limit=itemPerLoad;
									 			//alert(current_page);
									 			get_trans_date_paging_by_cat_name_day_month_year(db,name,offset,limit,day,month,year,transactions2);
									 			   
									 		},errorDB,function()
									 				    {
									 				    //	alert("finish");
									 				 	 var current_page=window.localStorage.getItem("current_page");
									 		 		  	 var str="";
									 		 		  		for (var i in transactions2.results)
									 		 		  		{	

									 		 		  			//	alert(transactions2.results[i]);
									 		 		  				var aDate=transactions2.results[i];
									 		 		  				var idName='collapse'+i+'page'+current_page+'';
									 		 		  				//alert(transactions2.results[i]);
												 		 		  	var str='<div data-role="collapsible">'+
																	'<h2 data-icon="false">'+
																		'<span style="float:left">'+formatDate(aDate)+'</span>'+
																		'<span style="float:right" class="pricecollapse'+i+'page'+current_page+'"></span>'+
																	'</h2><ul class="collapse'+i+'page'+current_page+'"data-role="listview"></ul></div>'
																	

																	contextObject.find(".list").append(str).collapsibleset("refresh");
																	
															 		get_trans_date_by_cat_name_date(db,name,aDate,idName,contextObject,addToCollapse);
							
			 		 		  								}
			 		 		  								contextObject.find(".list").parent().find(".loading").remove();
			 		 		  								contextObject.find(".loadmore").show();
			 		 		  								
			 		 		  								$(".loadmore").click(function(event){
										
																//alert("test");
																var contextObject=$(this).parent();
																//alert(contextObject.find(".list").html());
																$(this).hide();
																contextObject.find(".list").parent().append('<div class="loading"><img src="img/spinner.gif" alt="Loading..."/></div>'); 
																	var current_page=parseInt(window.localStorage.getItem("current_page"))+1;
															 	  	  var transactions2=new Object();
																		transactions2.results= new Array();
															 			window.localStorage.setItem("current_page",current_page);

															 	var data=window.localStorage.getItem("cat");
															 	//alert(data);

															 	if (data!="")
															 	{
															 		data=JSON.parse(data);
															 	//	alert(data.catName);
																	addResultToList(db,transactions2,data.catName,itemPerLoad,data.day,data.month,data.year,contextObject);									 	
																}
															 	else 
															 		addResultToList(db,transactions2,"",itemPerLoad,data.day,data.month,data.year,contextObject);

																event.preventDefault();
																event.stopImmediatePropagation();
															})


			 		 		  								if (transactions2.results.length==0)
			 		 		  								{
																contextObject.find(".list").parent().append('<div class="end">No more transactions</div>');
																contextObject.find(".loadmore").hide();
			 		 		  								}
							 				    		});*/
							
										}										
										var addToCollapse = function (alltrans,contextObject)
										{
											//alert("test");
											var str="";
											contextObject.find(".price"+alltrans.divname).text("$"+alltrans.total+" ("+alltrans.results.length+")");

											for (var i in alltrans.results)
											{
												//alert()
												var optional="<br>"+alltrans.results[i].optional;
												str+= '<li class="itemDetails" data-icon="false" style="overflow:hidden;font-size:11px;color:gray">';
												str+= '<span style="float:left">'+ capitaliseFirstLetter(alltrans.results[i].name)+optional+'</span><span id="transId" style="display:none">'+alltrans.results[i].transid+'</span>';
												str+= '<span valign="top" style="float:right">$'+alltrans.results[i].amount+'<div id="edit_delete'+alltrans.results[i].transid+'" class="edit_delete" style="padding-left:5px;display:none;float:right">test</div></span>';
												str+= '</li>'
											
											//	$('.edit_delete'+alltrans.results[i].transid)

											}

											contextObject.find("."+alltrans.divname).append(str);
											contextObject.find("."+alltrans.divname).listview();
											contextObject.find("."+alltrans.divname).listview("refresh");

											$('.itemDetails').bind("click",function(event1){
												
													//$.mobile.changePage("#transactionDetails");
													//event1.stopImmediatePropagation();

													event1.preventDefault();
													return false;

												});
	
		
										
											$('.itemDetails').bind("swipeleft",function(event){

												//	$("#lineChart").unbind('jqplotDataClick');
													//alert('.edit_delete'+transid).html();
													var transid=$(this).parent().find("#transId").text();
												//	alert(transid);
													if ( typeof $('#edit_delete'+transid).find('.delete').html() === "undefined" )
													{
														

														$('#edit_delete'+transid).show();
														$('#edit_delete'+transid).html('<a class="delete"><img src="img/delete.png" alt="delete" width="12px" height="12px" style="margin-top:0px"/></a>');

														

														$('#edit_delete'+transid).bind("click",function(event1){
																//alert("test clickevent"+$(this).attr("id"));
																//alert("testevent");
																//alert($(this).find(".already").html());
																if (typeof $(this).find(".already").html() === "undefined" )
																{
																//	alert("undefined");
																	$(this).append("<span class='already' style='display:none'>1</span");
																}
																else
																{
																	//	alert("testee");
																	var transactions2=new Object();
																	transactions2.results= new Array();										

																//	alert($(this).parent().parent().parent().find("#transId").text());

																	var transid=parseInt($(this).parent().parent().parent().find("#transId").text());
																
																	db.transaction(function(db)
												 				   	{
												 				   		delete_trans_by_id(db,transid);
												 						
												 					},errorDB,function()
												 				    		  { 
												 				    		  		window.localStorage.setItem("current_page",1);

																					var data=JSON.parse(window.localStorage.getItem("cat"));
																					
																					var itemPerLoad=window.localStorage.getItem('itemPerLoad');
																					offset=0,limit=0;
																					var contextObject=$("#cat");	
																					contextObject.find(".list").html("");
																					contextObject.find(".list").parent().find(".end").remove();
													 				    		  	
													 				    		  	addResultToList(db,transactions2,data.catName,itemPerLoad,data.day,data.month,data.year,contextObject);



												 				    		  }
												 				   );
																}
																event1.preventDefault();
																event1.stopImmediatePropagation();
																return false;
															})

													}
													else{
														//alert("test");
														$('#edit_delete'+transid).hide();
														$('#edit_delete'+transid).html("");
													}
													//alert($('#edit_delete'+transid));
															
														event.preventDefault();
														event.stopImmediatePropagation();
														return false;
											
												});

													
										
											//	alert(alltrans.results[i].transid);
												
											

											/*	$('html').click(function() {
												 //Hide the menus if visible
												 	//alert("Test");
												 	$(".edit_delete").hide();
												 });
											*/	
								
								
										}
								
									

						/******************************************/

				//jQuery('.selectTime < .ui-btn').css({'height':'20px'});
				$("#analytic").live( 'pageshow',function(event, ui){
					/**************budget insight to be change *************/	
				/*************slider *******************/
						var object=$("#slider");
						var slider = new Swipe(object[0], {callback: function(e, pos) {
								//alert("test");
							 	$('#positionInsight').children('em').removeClass('on');
					         	$('#positionInsight').find('#'+pos).addClass('on');	
								loadSpendInfo(selectCat.val(),selectDay.val(),selectMonth.val(),selectYear.val());

					         }
					      });

						$(".navone").click(function(e){
							//alert("test");

							e.preventDefault();
							//slider4.next();
							//alert($(this).attr('id'));
						   $('#positionInsight').children('em').removeClass('on');
						    $(this).addClass('on');	
							slider.slide($(this).attr('id'),300);

							
						})

				/*************\slider *******************/

				/*************populate month *******************/
				var monthNames = [ "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December" ];
			
				var current_month= (new Date().getMonth()+1)+"";
				var selectMonth=$("#selectMonth");
				selectMonth.selectmenu();

				for (var i=0;i<12;i++)
				{
					//var today=
					var aMonth= '<option value="'+(i+1)+'">'+monthNames[i]+'</option>';
					selectMonth.append(aMonth);
											 //  <option value="0">Everything</option>

				}
				selectMonth.val(current_month).attr('selected', true).siblings('option').removeAttr('selected');
				selectMonth.selectmenu('refresh');

				/*************\populate month *******************/
				/*************populate year *******************/
				var yearNames = [ "2011", "2012", "2013"];	
				var current_year= (new Date().getFullYear())+"";
				var selectYear=$("#selectYear");
				selectYear.selectmenu();

				for (var i=2011;i<=2013;i++)
				{
					//var today=
					var aYear= '<option value="'+(i)+'">'+yearNames[i-2011]+'</option>';
					selectYear.append(aYear);
											 //  <option value="0">Everything</option>

				}
				selectYear.val(current_year).attr('selected', true).siblings('option').removeAttr('selected');
				selectYear.selectmenu('refresh');


				/*************\populate year *******************/

				/**************popluate days*************/
				var selectDay=$("#selectDay");
				//selectDay.selectmenu();
				populateDays(current_month,current_year);

				function populateDays(month,year)
				{
					$("#selectDay").html("");
					var selectDay=$("#selectDay");	
					selectDay.selectmenu();
					var lastday=noDaysInMonth(month,year);
						selectDay.append('<option value="-1">All</option>');
					for (var i=1;i<=lastday;i++)
					{
						var aDay= '<option value="'+(i)+'">'+i+'</option>';
						selectDay.append(aDay);
					}
					selectDay.selectmenu('refresh');
				}
				var current_day= (new Date().getDate());
				selectDay.val(current_day).attr('selected', true).siblings('option').removeAttr('selected');
				selectDay.selectmenu('refresh');


				/**************\popluate days*************/
				

				/*************populate cat *******************/
				//alert("test");
				var selectCat=$("#selectCat");
				selectCat.selectmenu();

				var allcats=new Object();
				allcats.results=new Array();
				db.transaction(function(db)
								{
									getCats(db,allcats);
								},errorDB,function(){
									//search_results=cat;
								//	alert(allcats.results.length);
									for (var i=0;i<allcats.results.length;i++)
									{
										var aCat= '<option value="'+(i)+'">'+capitaliseFirstLetter(allcats.results[i])+'</option>';
										selectCat.append(aCat);
									}
									selectCat.selectmenu('refresh');
								});	

				$("#selectMonth").bind( "change", function(event, ui)
				{	  
					populateDays(selectMonth.val(),selectYear.val());
				    loadSpendInfo(selectCat.val(),selectDay.val(),selectMonth.val(),selectYear.val());
				
				});

				$("#selectDay,#selectYear,#selectCat").bind( "change", function(event, ui) {
  					//alert(selectDay.val());
					loadSpendInfo(selectCat.val(),selectDay.val(),selectMonth.val(),selectYear.val());
						
				});
				/*************\populate cat *******************/

				/*************spend/save info *******************/

				loadSpendInfo(selectCat.val(),selectDay.val(),selectMonth.val(),selectYear.val());
				console.log(selectCat.val());
				/*************\populate cat *******************/

				/*************pie chart *******************/

				/*************\pie chart *******************/


				/*************line graph *******************/

				/*************\line graph *******************/

				/*************trans details*******************/

				/*************\trans details*******************/
				
				function loadSpendInfo(cat,day,month,year)
				{

					//alert(slider.getPos());
					if(slider.getPos()==0)
					{
							$("#divselectDay").hide();
							$("#divSelectCat").hide();
							var alltrans=new Array();
							var chartValue=new Array();
							/*var chartValue= [
						    ['Food', 12],['Entertainment', 9], ['Groceries', 14],
						    ['Clothes', 16],['Transport', 7],['Food', 12],['Entertainment', 9], ['Groceries', 14],
						    ['Clothes', 16],['Transport', 7]
						  ];*/
							var alltrans=new Array();
							db.transaction(function(db)
										{
											//alert((parseInt(month))+" "+year);
											get_total_transactions_by_month_year_cat(db,(parseInt(month)),year,alltrans);
										},errorDB,function(){

										if (alltrans.results.isValid==1)
										{
											$(".chartEmpty").hide();
											for (i = 0; i < alltrans.length; i++) {
												var tmp=[alltrans[i].catname,alltrans[i].amount,alltrans[i].catid,month,year,slider];
												chartValue.push(tmp);	
												//alert(chartValue[i][0]+" "+chartValue[i][1]);	
											}
											//alert(alltrans.length+"finish");
										
											var pieChart=$("#pieChartInsight");
											pieChart.barChart();
											pieChart.data('barChart').pieChart('pieChartInsight',chartValue);

											$('#pieChartInsight').unbind('jqplotDataClick');
											$('#pieChartInsight').bind('jqplotDataClick', 
									            function (ev, seriesIndex, pointIndex, data1) {
									       			//
									            	//alert(data[pointIndex][0]+" "+data[pointIndex][2]+" "+data[pointIndex][3]+" "+data[pointIndex][4]);
									            	//alert(pointIndex);

									            	var selectMonth=$("#selectMonth");
									            	selectMonth.val(chartValue[pointIndex][3]).attr('selected', true).siblings('option').removeAttr('selected');
													selectMonth.selectmenu('refresh');

													var selectYear=$("#selectYear");
									            	selectYear.val(chartValue[pointIndex][4]).attr('selected', true).siblings('option').removeAttr('selected');
													selectYear.selectmenu('refresh');

													var selectCat=$("#selectCat");
									            	selectCat.val(chartValue[pointIndex][2]).attr('selected', true).siblings('option').removeAttr('selected');
													selectCat.selectmenu('refresh');

													chartValue[pointIndex][5].slide(1,300);
									            }
									        );
										}
										else
										{
											//alert("test");
											$("#pieChartInsight").html("");
											$(".chartEmpty").show();
										}

									})
							

					}
					else 
						if (slider.getPos()==1)
						{
							$("#divselectDay").hide();
							$("#divSelectCat").show();
							var alltrans=new Array();
							var maxData=new Array(),minData=new Array();
							var dataresult=new Array();
							db.transaction(function(db)
										{
											//alert((parseInt(month))+" "+year);
											get_transactions_by_month_year_cat(db,cat,(parseInt(month)),year,alltrans);
										},errorDB,function(){
											if (alltrans.results.isValid==1)
											{
												$(".chartEmpty").hide();
												var minTmpDate=new Date(3000,1,1); maxTmpDate=new Date(1000,1,1);
												var average=0;
												for (var i=0;i<alltrans.length;i++)
												{ 

													//alert(alltrans[i].updated_at+" "+alltrans[i].amount);
													//var tmpDate= new Date(Date.parse(alltrans[i].updated_at);
														//var dt  = (alltrans[i].updated_at+"  00:00:00").split(/\-|\s/)
			    									
			    									var tmp=alltrans[i].updated_at.split("-");
			    									//alert(tmp[2]);
			    									//var year=parseInt(tmp[3])
			    									//alert(year);
			    									var tmpDate = new Date(parseInt(tmp[0]),(parseInt(tmp[1])-1),parseInt(tmp[2]));
													//alert(tmpDate);
													//alert(tmpDate);

													if (minTmpDate>tmpDate)
													{
														minTmpDate=tmpDate;
													}
													if (maxTmpDate<tmpDate)
													{
														maxTmpDate=tmpDate;
													}
													var tmpTrans=[tmpDate,alltrans[i].amount,cat,month,year,slider];
													//alert(tmpTrans);
													if (alltrans[i].amount==alltrans.value.max)
														{
															maxData.push(tmpTrans)
														}
														else
															if (alltrans[i].amount==alltrans.value.min)
															{
																minData.push(tmpTrans);
															}
													dataresult.push(tmpTrans);
												}
												//console.log(data);
												//console.log(maxData);
												//console.log(minData);
												var lineChart=$("#lineChart");
												lineChart.barChart();
												lineChart.data('barChart').lineChart('lineChart','#5E87B0',dataresult,maxData,minData,minTmpDate,maxTmpDate,alltrans.value.min,alltrans.value.max,Math.round(alltrans.value.spent/alltrans.length));
								           
												//search_results=cat;
												//alert(allcats.length);
										      	  	$("#lineChart").unbind('jqplotDataClick');
													$("#lineChart").bind('jqplotDataClick',
										            function  (ev, seriesIndex, pointIndex, data1) 
										            { 
										            //	alert(data1);
										            	var str=(data1+"").split(',')[0];
										            	//alert(str);
										            	var aDate=(new Date(parseFloat(str))).getDate();
										            	
										            	//alert('series: '+seriesIndex+', point: '+pointIndex+', data: '+data); 
										            	var selectDay=$("#selectDay");
										            	selectDay.val(aDate).attr('selected', true).siblings('option').removeAttr('selected');
														selectDay.selectmenu('refresh');

										            	var selectMonth=$("#selectMonth");
										            	selectMonth.val(dataresult[pointIndex][3]).attr('selected', true).siblings('option').removeAttr('selected');
														selectMonth.selectmenu('refresh');

														var selectYear=$("#selectYear");
										            	selectYear.val(dataresult[pointIndex][4]).attr('selected', true).siblings('option').removeAttr('selected');
														selectYear.selectmenu('refresh');

														var selectCat=$("#selectCat");
										            	selectCat.val(dataresult[pointIndex][2]).attr('selected', true).siblings('option').removeAttr('selected');
														selectCat.selectmenu('refresh');

														dataresult[pointIndex][5].slide(2,300); 

										           	});
									
											}
											else
											{
														$("#lineChart").html("");
														$(".chartEmpty").show();
											}		
										});
						}
						else
						{
							$("#divselectDay").show();
							$("#divSelectCat").show();
							var  aTmpCat= new Object();
							db.transaction(function(db)
										{
										//alert(cat+" "+(parseInt(month)-1)+" "+year);
											get_cat_name_by_id(db,cat,aTmpCat);				
										},errorDB,function(){
											var data= new Object();
											data.catName=aTmpCat.data.name;
											data.month=month;
											data.year=year;
											data.day=day;
											window.localStorage.setItem('cat',JSON.stringify(data));
											//alert(aTmpCat.data.name);
												var transactions2=new Object();
												transactions2.results= new Array();
												window.localStorage.setItem('current_page',1);
												window.localStorage.setItem('itemPerLoad',5);
												var itemPerLoad=window.localStorage.getItem('itemPerLoad');
												offset=0,limit=0;
												var contextObject=$("#analytic");	
												contextObject.find(".list").html("");
												contextObject.find(".list").parent().find(".end").remove();
												//alert(data.day);
												addResultToList(db,transactions2,data.catName,itemPerLoad,data.day,data.month,data.year,contextObject);
												//alert();
										})
							
						}
				}


				/*	var chartValue=new Array();
					for (var i=1; i<30;i++)
					{
						var display='';
						var tmp=Math.round(Math.random()*50);
						if (tmp==20)
						{
							display='(Avg)';
						}
						var value =[i,tmp];

						chartValue.push(value);
					}

				//	var chartValue=[1,1,1,1,2,7,100,1,20,1,1,010,1,270,100,7,10,2,,90,7,10];	
					var lineChart=$("#lineChart");
					lineChart.barChart();
					lineChart.data('barChart').lineChart('lineChart','#5E87B0',chartValue);
*/

				})
				$("#cat").live( 'pageshow',function(event, ui){

				//if($.mobile.activePage.attr("id") == "cat"){
									//alert("test");
									
								/*	window.localStorage.getItem("cat");
								*/
									//alert(window.localStorage.getItem("cat"));
									var data=JSON.parse(window.localStorage.getItem("cat"));


									var total=$("#total");
									total.barChart();
									total.data('barChart').showChart('total','#993333', '#339900', data.spent,data.left,data.isBudget);

									$("#dateLeft").text(daysInMonth());	
									$("#catTitle").text(capitaliseFirstLetter(data.catName));
									$("#catLbl").text("#"+data.catName);
									$("#cat_track_area").inputText();
									$("#cat_track_area").data('inputText').init();
                                     

									var transactions=new Object();
									transactions.results= new Object();
									db.transaction(function(db)
								 				   {
								 				   		var current_month= (new Date().getMonth()+1)+"";
								 				   		//alert(current_month);
								 				   		transactions1.results.maxSpend=0;
								 				   		transactions1.results.minSpend=0;
								 				   		transactions1.results.avgSpend=0;

								 				   		get_trans_max_min_avg_by_cat_name_month(db,data.catName,current_month,transactions);

								 						
								 					},errorDB,function()
								 				    		  { 
								 				    		  //	alert(transactions.results.maxSpend);
								 				    		  	$("#amountMax").text("$"+abbrNum(transactions.results.maxSpend,2));
								 				    		  	$("#amountMin").text("$"+abbrNum(transactions.results.minSpend,2));
								 				    		  	$("#amountAvg").text("$"+abbrNum(transactions.results.avgSpend,2));
								 				    		  }
								 				   );
									
									/*var transactions=new Object();
									transactions.data= new Array();
									
									db.transaction(function(db)
								 				   {
								 				   		get_trans_last_7_days_by_cat_name(db,data.catName,transactions);
								 				    },errorDB,function()
								 				    		  { 
								 				    		  	var chartValue=new Array();
								 				    		  	var seven_dates=new Array();
								 				    		  	seven_dates=process_seven_days(transactions.data);
								 				    		  	//alert(seven_dates); 
								 				    		  	for (var i in seven_dates)
															 	{
															 		//alert(seven_dates[i]);
															 		chartValue.push(seven_dates[i] * -1);
															 		//console.log(i+" "+final_date[i]);
															 	}
															 			$("#legendLine").text(capitaliseFirstLetter(data.catName)+" Expenses last 7 days");
								 				    		  	
								 				    		  });	*/
									var transactions1=new Object();
									transactions1.results= new Object();
									db.transaction(function(db)
								 				   {
								 				   		var current_month= (new Date().getMonth()+1)+"";
								 				   		//alert(current_month);
								 				   		transactions1.results.perccat=0;
								 				   		transactions1.results.percothers=0;
								 						get_trans_perc_by_cat_name_month(db,data.catName,current_month,transactions1);	    
								 					},errorDB,function()
								 				    		  { 
								 				    		  		//var chartValue = [['a',transactions1.results.perccat],['b',transactions1.results.percothers]];
								 				    		  
																	var donutChart=$("#donutChart");
																	donutChart.barChart();

																 if ((isNaN(transactions1.results.perccat))||(transactions1.results.perccat==0))
																 {
																 	transactions1.results.perccat=0;

																 }
																 if ((transactions1.results.perccat+"").length==1) 
																 {
																 		$("#valueDonutChart").text(transactions1.results.perccat+"%");
																 		$("#valueDonutChart").css({"font-size":"28px","margin-top":"-90px","margin-left":"30px"});
																 	
																 }
																 else 
																 	if ((transactions1.results.perccat+"").length==3)
																 	{
																 		//alert("test");
																 		$("#valueDonutChart").text(transactions1.results.perccat+"%");
																 		$("#valueDonutChart").css({"font-size":"21px","margin-top":"-88px","margin-left":"22px"});
																 	}
																 	else	 
																 	{
																 		$("#valueDonutChart").text(transactions1.results.perccat+"%");
																 		$("#valueDonutChart").css({"font-size":"26px","margin-top":"-90px","margin-left":"26px"});
																 	}

																 	var chartValue= [[data.catName,transactions1.results.perccat], ['Others',100-transactions1.results.perccat]] ;
																 
																	donutChart.data('barChart').donutChart('donutChart','#993333', '#339900',chartValue);
																	$("#legendPieCat").text(capitaliseFirstLetter(data.catName));
																	$("#legendPie").show();
																	
																 
								 				    		  });
									var transactions2=new Object();
									transactions2.results= new Array();
									window.localStorage.setItem('current_page',1);

									window.localStorage.setItem('itemPerLoad',5);
									var itemPerLoad=window.localStorage.getItem('itemPerLoad');
									offset=0,limit=0;
									var contextObject="#cat";
									window.localStorage.setItem("contextObject",contextObject);	
									$(contextObject).find(".list").html("");
									$(contextObject).find(".list").parent().find(".end").remove();
									//addResultToList(db,transactions2,data.catName,itemPerLoad,contextObject);
									addResultToList(db,transactions2,data.catName,itemPerLoad,data.day,data.month,data.year,contextObject)
									//alert("addresultlist");
								});
				

				$("#listCats").live( 'pageshow',function(event, ui){

					var cat=new Object();

					db.transaction(function(db){
									get_all_cats(db,cat)

									},errorDB,function(){
										//alert("test");
										//alert(cat.results.length);
										$("#allCatsList").html("");
										var str="";
										for (var i=0; i<cat.results.length;i++)
										{
											 str=str+'<li class="editable">'+
											 		'<span class="lblCatId" style="display:none">'+cat.results[i].id+'</span>'+
													'<span class="lblCat" style="display:block">'+cat.results[i].name+'</span>'+
													'<input type="text" style="display:none" class="txtCat"></input>'+
													'</li>'
									
										}
										$("#allCatsList").append(str);
										$("#allCatsList").listview();
										$("#allCatsList").trigger("create");
										$("#allCatsList").listview("refresh");



										$(".txtCat").blur(function(){
													$(this).parent().find(".lblCat").show();
													$(this).parent().find(".txtCat").hide();
													$(this).parent().find(".lblCat").text($(this).parent().find(".txtCat").val());
													var name=$(this).parent().find(".lblCat").text();
													var id=$(this).parent().find(".lblCatId").text();
													saveCat(id,name);

											})
											$(".editable").bind("click",function(e){
												e.preventDefault();
												$(this).find(".txtCat").val($(this).find(".lblCat").text());
												$(this).find(".lblCat").hide();
												$(this).find(".txtCat").show();
												$(this).find(".txtCat").focus();
												//alert("test");
												return false;
											});

											$(".txtCat").keyup(function(ev) {
											    // 13 is ENTER
											    if (ev.which === 13 ) {

													$(this).parent().find(".lblCat").show();
													$(this).parent().find(".txtCat").hide();
													$(this).parent().find(".lblCat").text($(this).parent().find(".txtCat").val());
													var name=$(this).parent().find(".lblCat").text();
													var id=$(this).parent().find(".lblCatId").text();
													saveCat(id,name);
											  	}
											});




									});

					function saveCat(id,name)
					{
						db.transaction(function(db){
											update_cat_by_id(db,id,name);
											},errorDB,function(){
										});


					}

					
				})

				$(document).bind('pageinit',function(event){		

					$("#home").live( 'pageshow',function(event, ui){
						//alert("test");
						loadAllCats();
						loadAllDashboard();
						initTransDetails();
							
					})
				

						preload([
						    'img/delete.png',
						]);		
									
						db= openDB();		
						db.transaction(populateDB, errorDB, successDB);

					
					SYNCDATA.initSync(function(){
					})

					/*	db.transaction(function(db){
							var data= new Array();
							data['cat']="clothes";
							data['createdDate']="2012-12-01 00:00:01";
							//data['createdDate']
							insertNewCat(db,data);
							
						},errorDB,successDB);
					*/

					//	db.transaction(function(db){
											//listTrans(db,"2012-05-05","2012-05-05","");
										//getTotalBalance(db,cats);
					//					}, errorDB, successDB);

						loadAllCats();
						loadAllDashboard();
						initTransDetails();	

						var cat=new Object();
						cat.results=new Array();
						//alert("test");
										
						var value={spent:0,left:0};
						
						
					
						var object=$("#slider4");
						var slider4 = new Swipe(object[0], {callback: function(e, pos) {
							 	$('#position').children('em').removeClass('on');
					         	$('#position').find('#'+pos).addClass('on');	
					         }
					      });


					
				
						populateRecurring();

 			
										

				/************** done insight *************/	
				
			


							$(document).bind('pagechange',function(e){

								//e.preventDefault();
								//e.stopImmediatePropagation();
								
							//	else 
								if ($.mobile.activePage.attr("id") != "cat") 
								{
									window.localStorage.setItem("cat", "");
									
									if ($.mobile.activePage.attr("id") == "transDetails") 
									{
										
									}
									else
										if ($.mobile.activePage.attr("id") == "analytic") 
						 				{

						 				}
						 				else
						 				if ($.mobile.activePage.attr("id") == "home") 
						 			
										{
											window.localStorage.removeItem("cat");
											window.localStorage.setItem("cat", "");
											//loadAllDashboard();
										

										}
								}
							})	
  


						$("#scroller").scroller({ 
													display :'modal',
													preset : 'date',
													theme : 'android-ics',
													dateOrder: 'ddmmyy',
													dateFormat:  'dd-mm-yy',
													setText : 'Select',
 													anchor : $("#dateLnk"),
 													height:40,
 													width:60,
 													headerText:false,
 													onSelect: function(value,inst){
 														 $("#dateLnk").text(jQuery.scroller.formatDate('dd-mm-yy',$("#scroller").scroller('getDate')));	
					
 													}
												});
					 	$("#dateLnk").text(jQuery.scroller.formatDate('dd-mm-yy',$("#scroller").scroller('getDate')));	
					 	$("#dateLnk").click(function(event){
							event.preventDefault();
							
							$("#scroller").scroller("show");

							return false;
						});

					 	function initTransDetails()
					 	{
					 				var transactions2=new Object();
										transactions2.results= new Array();
										window.localStorage.setItem('itemPerLoad',5);
										var itemPerLoad=window.localStorage.getItem('itemPerLoad');
										window.localStorage.setItem('current_page',1);

										var contextObject="#transDetails";
										window.localStorage.setItem('contextObject',contextObject);
										var list=$(contextObject).find(".list");
										list.html("");

										$(contextObject).find(".list").parent().find(".end").remove();								

										//addResultToList(db,transactions2,"",itemPerLoad,contextObject);

										var now = new Date();

										addResultToList(db,transactions2,"",itemPerLoad,-1,now.getMonth()+1+"",now.getFullYear(),contextObject);
					 	}
						
					 	function length_numbers()
					 	{

					 		var i=findNextSign(1,$("#track_area").val());
					 		//alert(i);
					 		var string=$("#track_area").val().substring(0,i);
					 		//alert(string);
					 		return string.length;
					 	}

					
						$("#track_area").bind("click taphold",function() {
							//alert($("#track_area").getCursorPosition());
					        

					        if ($('#track_area').getCursorPosition()<length_numbers())
    						{
    							$('#track_area').setCursorPosition(length_numbers());	
    							if (symbol!="$")
    							{
    									symbols[symbol]=0;
    									symbol="$";
    									symbols[symbol]=0;
    							}	
    						}

    						var text=$("#track_area").val();
								/*********** find nearest symbol *********************/
    					    var currentString=text.substring(0,$("#track_area").getCursorPosition());
    					    var pos=findLastSign(currentString);

    					  //  alert(currentString.charAt(pos));
    					    if ((currentString.charAt(pos)!=symbol)|| (pos!=symbols[symbol]))
    					    {
    					    	if (symbol=="#")
									turnAutoOff();
								if (pos!=currentString.length)
    								{	
    									symbols[symbol]=0;
    									symbol=currentString.charAt(pos);
    									symbols[symbol]=pos;
    								}
    							
    					    }	
    						/******************************************************/
						});
						
    					
//  alert($("#track_area").getCursorPosition()<4);


					 	$('#track_area').keypress(function(e) {

					 		if ((e.which==36)||(e.which==35)||(e.which==126))
					 		{

					 			if ($('#track_area').val().indexOf(String.fromCharCode(e.which))>-1)
					 			{
					 				$("#errorMsg").text("You can't enter "+String.fromCharCode(e.which)+" more than once");
					 				e.preventDefault();
					 				return;
					 			}

					 		}
							if ((symbol=="$")&&(e.keyCode!=8))
    						{
    							 if(e.charCode == 35) { //@ Symbol
    							 	//alert("test");
    							 	 //$("#track_area").setCursorPosition(2);

					             enterHashtag(e);
    							////	$("#errorMsg").text("");

					         	 }
					         	 else
					         	 {
					         

	    							if (e.keyCode==32)
	    							{
	    								enterHashtag(e);
	    							}
	    							else
	    							{
	    								var character=String.fromCharCode(e.keyCode);
	    								console.log(character+" "+e.keyCode);
	    								
	    								enterNumber(character);
	    								//if (e.keyCode!= 32)
	    								e.preventDefault();
	    								
	    							}

    							}
    						}
    						else{

	    					 	clearInterval(timer);
	    					 		timer = setInterval(trackInput, 100);
	    								console.log("input");
    						}

					    });



    					$('#track_area').keyup(function(e){

    						

    						var text= $('#track_area').val();
    						if (text=="")
    							$('#track_area').val("$0.00");


    						/*********** find nearest symbol *********************/
    					    var currentString=text.substring(0,$("#track_area").getCursorPosition());
    					    var pos=findLastSign(currentString);

    					  //  alert(currentString.charAt(pos));
    					    if ((currentString.charAt(pos)!=symbol)|| (pos!=symbols[symbol]))
    					    {
    					    	if (symbol=="#")
									turnAutoOff();
								if (pos!=currentString.length)
    								{	
    									symbols[symbol]=0;
    									symbol=currentString.charAt(pos);
    									symbols[symbol]=pos;
    								}
    							
    					    }	
    						/******************************************************/


    					/*	if ((text.lastIndexOf(symbol)==-1) || (text.lastIndexOf(symbol)!=symbols[symbol])) 
    							{
    								//alert(symbol+" symbol");
    								text.lastIndexOf(symbol);
    								//alert(symbol+"a"+symbols[symbol]+"a"+text.lastIndexOf(symbol));
    								if (symbol=="#")
										turnAutoOff();

    								var deleteString=text.substring(0,$("#track_area").getCursorPosition());
    								//alert(deleteString+"string");
    								var pos=findLastSign(deleteString);
    								//alert(pos);
    								if (pos!=deleteString.length)
    								{	
    									symbols[symbol]=0;
    									symbol=deleteString.charAt(pos);
    									symbols[symbol]=pos;
    								}
    								else
    									symbol="~";
    								//alert(symbol);
    							}
					*/

    						
    						
	    						 if (e.keyCode == 13)
	    						 {
	    						 	enterToSave();
	    						 	//switchOffTextScreen();
	    						 	//entertoPending(text);
	    						 }

    						 	if (symbol=="#") 
	    						{

	    							//alert("test");
	    							var last_char=text.substr(text.length-2,1);
	    							if (last_char!=" ")
	    							{
	    								turnAutoOn();	
		    							populateList(symbol);
		    						}	
	    						}

								



	    						if (symbol=="$")
    							{
    									var pos=findNextSign(text.indexOf("$")+1,text);
    									$('#track_area').setCursorPosition(pos);
    								
    								//alert(symbol);
    								if (e.keyCode != 8)
    								{
    									//alert("test");
    								//	var beforeSign=text.substring(0,text.indexOf("$")+1);
	    							//	var afterSign=text.substring(text.indexOf("$")+1,text.length);
	    								//alert(afternumber);
	    								
		    							/*var deleteString=text.substring(0,$("#track_area").getCursorPosition());
		    							//alert(deleteString+"aaa");
		    							var last_space=$("#track_area").getCursorPosition()-1;
		    							var last_char=text.charAt(last_space);
		    							alert(last_char);
		    							//if 
		    							
		    						//		console.log(afternumber);
		    							if ((isNumber(last_char)) && (text.charAt(last_space-2)=="."))
		    							{
		    							//	alert(afternumber);
		    						//		$('#track_area').val($('#track_area').val()+afternumber);
		    								
		    						//		afternumber="";
	    								}*/	    							//	console.log(length_numbers());
	    							}
    							}

    					})

    					$('#track_area').keydown(function(e){
    						if ($("#track_area").is(":focus")) {
								if ($("#profile").is(':visible'))
								{
									switchOnTextScreen();
								}
							}

    						//e.preventDefault();


    						//alert(e.charCode);
    						//if ((e.shiftKey) && (String.fromCharCode(e.keyCode)=="3"))
    						//	alert("test");

    						//alert();


       						var text= $('#track_area').val();
    						if ($('#track_area').getCursorPosition()<length_numbers())
    						{
    							$('#track_area').setCursorPosition(length_numbers());
    							if (symbol!="$")
    							{
    									symbols[symbol]=0;
    									symbol="$";
    									symbols[symbol]=0;
    							}

    							e.preventDefault();
    							return false;
    							//alert("test");	
    						}
    						else
    						{

	    						if (e.keyCode==8)
	    						{
	    							
	    							//alert(symbol);

	    							//alert();

	    							//alert(symbol);
	    							//alert(text.substr(text.length-1,1)+ symbol);

	    						//	alert(last_char);
		    						/*if (text.indexOf(symbol)==-1)
		    						{
		    						}*/
		    					/*	if (text.indexOf("$")==-1) 
		    						{

		    							if (symbol=="+")
		    							{
		    								text=text.replace("+ ","");
		    								$('#track_area').val(text);
		    							}
		    							else
		    								if (symbol=="-")
		    								{
		    									text= text.replace("- ","");
		    								 	$('#track_area').val(text);
		    								}
		    							 
		    						}*/
		    					
		    						if (symbol=="$") 
		    						{
		    							//alert("test");
		    						//	var last_space=text.indexOf(" ",text.indexOf("$")+2);
		    							var beforeSign=text.substring(0,text.indexOf("$")+1);
		    							var afterSign=text.substring(text.indexOf("$")+1,text.length);
		    							//alert(beforeSign+"before"+afterSign);
		    							//var last_space=findNextSign(afterSign)+beforeSign.length;
		    							//alert(last_space);
		    							//alert(last_space+" "+text.charAt(last_space)+" last pace");
									    							
		    							//alert(last_space+" last last_space");
		    							//if (last_space==-1)
		    							//{
		    							//	last_space=text.length;
		    							//}

		    							var deleteString=text.substring(0,$("#track_area").getCursorPosition());
		    							//alert(deleteString+"aaa");
		    							var last_space=$("#track_area").getCursorPosition()-1;
		    							//alert(text.charAt(last_space));

		    							var last_char=text.charAt(last_space);
		    							//alert(text.charAt(last_space-2));
		    							
		    			//				if (isNumber(last_char)) alert(text+" "+last_char);
		    					//		afternumber="";
		    							if ((isNumber(last_char)) && (text.charAt(last_space-2)=="."))
		    							{
		    								e.preventDefault();
		    								trackDecimal--;
		    								var number=text.substring(text.indexOf("$")+1,last_space+1);
		    							//	alert(number);
		    								var decimal=number.substring(number.indexOf(".")+1,number.length);
		    								var n=number.substring(0,number.indexOf("."));
		    								afternumber=text.substring(last_space+1,text.length);
										
		    								//alert(afternumber+" "+trackDecimal);

		    								//if (afternumber.length>0)
		    								//	afternumber=" "+text.substring(last_space+1,text.length)+" ";

		    								//alert(afternumber);
		    							//	if (n.length>1)
		    							//	{
		    									decimal=n.substr(n.length-1,1)+decimal;
		    									n=n.substring(0,n.length-1);
		    									
		    									//alert(n+"."+decimal);
		    									if (n=="") n="0";
		    									if (decimal.length==1) 
		    										decimal="0"+decimal;
		    									//console.log(n+"d"+decimal);
		    							
		    								decimal=decimal.substring(0,decimal.length-1);
		//    								console.log(decimal+" decimal");
			

		    									if ((n=="0") && (decimal=="00"))
		    									{
		    										trackDecimal=0;
		    										//var stringToReplace=symbol+"0.00";
		    										
		    									//	var newtext=$('#track_area').val().replace(stringToReplace,"");
		    									//	$('#track_area').val(newtext);
		    										//alert(afternumber);
		    										
		    									//	return false;
		    									}
		    									
		    									$('#track_area').val(text.substring(0,text.indexOf("$")+1)+n+"."+decimal);
		    									$('#track_area').val($('#track_area').val()+afternumber);

		    								text=$('#track_area').val();	
			    							var pos=findNextSign(text.indexOf("$")+1,text);
	    									$('#track_area').setCursorPosition(pos);
		    									//else
											
		    							//	}
		    							//	else
		    							//	{

		    							//	}

		    								//	alert(n+"r"+decimal);
		    								//if (n!="0")
		    								//{

		    								//}

		    								//alert(decimal+"r"+n);

		    								//alert(number);
		    								//alert(chare);
		    							/*	if ((no=="0.00") && (chare=="$"))
		    									$('#track_area').val("");
		    								else
		    								{
		    									var string=text.substring(text.indexOf(symbol),text.indexOf("$")+1);
		    									//alert(string);
		    									//alert(text+" "+string);
		    										
		    								}*/


		    							
		    							}

		    						}
		    						
		    				
		    						/*if ((text.indexOf(symbol)==-1)|| (symbol==" "))
		    						{
		    							if (symbol=="#")
	    									turnAutoOff();
	    								if (symbol!=" ")
		    							{	
		    								symbols[symbol]=false;
	    									symbol=" ";
	    								}
	    								for (var i=text.length-1; i>=0;i--)
	    								{
	    									if (iSym(text.charAt(i)))
	    									{
	    										symbol=text.charAt(i);
	    										if (symbol=="#")
			    								{
			    									turnAutoOn();	
			    									populateList(symbol);
			    									//alert("test");
			    									//	console.log(symbol+"symbol");
			    								}
			    								symbols[symbol]=true;
	    										break;
	    									}
	    								}
	    								

	    							}*/
		    						//trackInput();
		    						//alert(symbol);
	    						}
		      				}
		      				//trackInput();

    							
    					});


/*****************************charting*****************************************************/

						function showChart(id,color1,color2,value1,value2)
						{
							var name="barChart"+id;
							var idw2=name+"L";
							var idw=name+"S";
							var total=value1+value2;
							var perc1=Math.round(Number((value1/total)*100));
							var perc2=Math.round(Number((value2/total)*100));
							//alert(idw);
							$("#"+name).html("");
						  $.jqplot(name, [[perc1],[perc2]], {
					  	  stackSeries: true,
							seriesDefaults: {
						      renderer: $.jqplot.BarRenderer,
						      rendererOptions: {
						        varyBarColor: true,
						        barDirection: 'horizontal',
						          highlightMouseOver: false,
							        highlightMouseDown: false,
							        highlightColor: null,
							         barWidth: 50,


						      },
						      pointLabels: { 
						        show: false,
						      },
						      shadow: false,
						    },
						    axes: {
						      xaxis: {
						        //renderer: $.jqplot.CategoryAxisRenderer,
						        ticks:[0,100],
						        tickOptions: {
						          showGridline: false,
						          showMark: false,
						          //fontFamily: 'DosisBold',
						          textColor: '#ffffff',
						          fontSize: 'larger',
						          showLabel:false,

						        },
						      },
						      yaxis: {
						      	renderer: $.jqplot.CategoryAxisRenderer,
						        // ticks: ['love','hate'],
						        tickOptions: {
						          showGridline: false,
						          showMark: false,
						          fontFamily: 'DosisBold',
						          textColor: '#ffffff',
						          fontSize: 'larger',
						          showLabel:false
						        },
						      },

						    },
						    seriesColors: [color1,color2],
						    grid: {
							  background: 'transparent',  
						      drawGridLines: false,
						      borderWidth: 0.0,
						      shadow: false,
						    },

						    highlighter: { show: false },

						  }).replot({clear: true, resetAxes:true});	
							
							var w = parseInt($(".jqplot-yaxis").width(), 10) + parseInt($("#"+name).width(), 10);
							var h = parseInt($(".jqplot-title").height(), 10) + parseInt($(".jqplot-xaxis").height(), 10) + parseInt($("#"+name).height(), 10);

							$("#"+name).width(w).height(h);								
						//	plot;


							//$("#barChart").remove('barChartW');
							$("#" + idw).text("$"+abbrNum(value1,2));
							$("#" + idw2).text("$"+abbrNum(value2,2));
					
							var canvas= $("#"+name).find('.jqplot-event-canvas');
							canvas.css("cursor","pointer");
									//alert(canvas.html());
									canvas.click(function(){
										//alert();
									})
							
							var barChartName=$("#"+id).find('.barChartName');
							barChartName.css("cursor","pointer");
							
							//alert(barChartName.html());
								barChartName.click(function()
								{
									//alert("test");
								})


							}



/*****************************charting*****************************************************/


						
						$("#suggestions li").live('click', function(e) {
							e.preventDefault();
							//alert("test");
							var title=$(this).attr('title');
							if (title!='not found')
							{
								var text=$('#track_area').val();
								text=text.substr(0,text.indexOf("#")+1)+title;
								
								turnAutoOff();
								symbols[symbol]=false;
	    						symbol=" ";

								$('#track_area').focus();
	    						$('#track_area').val(text+" ");
    						}
						});
						function entertoPending(text)
						{
							  $('#errorMsg').html("");
    						  var line=text.substr(0,text.length);
    						  var newline="\n"+line;
    						  var posBreak=newline.lastIndexOf("\n");
    						 // console.log(newline);
    						 // console.log(posBreak);
    						  var msg=stringValidate(newline.substring(posBreak,newline.length));

    						   if (msg!="")
    						   {
    						 //  	e.preventDefault();
    						   	//alert(msg);
    						   	$('#track_area').val(line);
    						   	$('#errorMsg').html(msg);
    						   //	return false;
    						   }
    						   else
    						   {
    						   	 var daten=$("#scroller").scroller('getDate');
    						   	 var date=jQuery.scroller.formatDate('yy-mm-dd',daten);
    						   	 	
    						     if (lastdate.getTime()!=daten.getTime())
    						   	 {
    						   	 	//alert(daten+" "+lastdate);
    						   	 	
    						   	 	var string=trimString($('#resultMsg').html())+"<div class='"+date+"'> On "+ date +" :</div>";
    						   	 	$('#resultMsg').html(string);
    						   	 	date_pending[date]=0;
    						   	 	lastdate=daten;
    						   	 }
    						   
    						    var transType=$('input[name=transType]:checked', '#radioBtns').val();
    						   	

    						   //	 alert($('#resultMsg').html());
    						   	var resultMsg= $('#resultMsg').html()+"<div class='"+date+"'' style='font-size:11px'>"+transType+trimString(text)+"<a class='deleteLink' href='#''> <img src='img/round_delete.png' width='7px' height='7px'/></a></div>";
    						   
    						   	date_pending[date]++;
    						   	//console.log(resultMsg);
    						   	$('#resultMsg').html(resultMsg);
    						   	$('#track_area').val("$0.00");
    						   
    						   	trackDecimal=0;
    						   	symbols[symbol]=false;
    							symbol="$";
    						   }
    						  // else
    						 
						}

						function enterHashtag(e) {
							//alert("rewq");
	    								$('#track_area').val($('#track_area').val()+" #");
	    								symbols[symbol]=0;
	    								symbol="#";
	    								symbols[symbol]= $('#track_area').val().length-1;
	    								

	    								turnAutoOn();
	    								populateList(symbol);

	    								
	    								$("#errorMsg").text("");
	    								e.preventDefault();
	    						

						}

						function iSym(chara)
						{
							//console.log(chara);
							//console.log(symbols);
							//alert(chara);
							for (var sym in symbols)
							{	
								//alert(sym);
								if (chara==sym)
									return true;
							}
							return false;

						}
						
						function trackInput(){
							//alert(symbol);
							//alert("test")
							clearInterval(timer);
    						var text= $('#track_area').val();
    						//alert(trimString(text)+"a");

    						var last_char=text.substr(text.length-1,1);
    						//alert(last_char);
    					//	
    						//alert(isSymbol(" "));

    						//alert(symbol+"symbol");
    						//console.log(symbol+ "symbol");
    						if ((iSym(last_char)) || (text=="")|| (last_char==" ") )
    						{
    						//	if ((text.indexOf(symbol)==-1)||((text.indexOf(symbol)>=-1)&&(last_char==" ")))
    							{
	    							if (symbol=="#")
	    							{
	    								//alert("test");
	    								turnAutoOff();
	    							}
	    							symbols[symbol]=0;
	    							symbol=last_char;
	    							symbols[symbol]=text.length-1;
		    						
	    								if (symbol=="#")
			    								{
			    									turnAutoOn();	
			    									populateList(symbol);
			    									//	console.log(symbol+"symbol");
			    									//symbols[symbol]=true;
			    								}
			    								else
			    									if (symbol=="$")
		    										{

		    											//$('#track_area').val(text+" $0.00");
		    											//trackDecimal=0;
		    											//$$('#track_area').
		    										}
		    					}	
    						}
    						else
    						{

    							if (symbol=="#") 
	    						{	
	    							//turnAutoOn();	
	    							populateList(symbol);
	    						}
	    						else
	    						{
	    							//if (symbol=="+" || symbol=="-")
	    							//{
	    							//	if (isNumber(last_char))
	    							//	{
	    									//var final_text="";
	    									
	    							//	}

	    							//}
	    						}

    						}

    						
    					/*	if (symbol==" ") 
    						{
    							
	    						
	    						
    						}

    					*/


					}

					function setListDefault()
					{

							//alert("test");
							//search_results=cat;
							str="";
							//console.log(search_results);	
							var sugList = $("#suggestions");

				 				//console.log(search_results);
				 			for (var i=0, len=all_cat_static.length;i<len;i++)
    						{

    							str += "<li data-icon='false' title='"+all_cat_static[i]+"''><a style='font-size:12px'>" +all_cat_static[i] +"</a></li>";
    						}
    						//console.log(str);
    						
    						sugList.html(str);
    						sugList.listview("refresh");

					}

					function turnAutoOn()
					{
						//symbols[symbol]=true;
						//alert("on");
						$('#track_area').css('max-height',"35px");
	    				$('#instructionTxt').hide();
	    				$('#suggestions').show();
						//return true;

					}
					function turnAutoOff()
					{
						//symbols[symbol]=false;
    					$('#instructionTxt').show();	
    					$('#track_area').css('max-height',"100px");
    					$('#suggestions').hide();
    					clearSuggestList();
    					return false;
					}

					$(".deleteLink").live('click',function(){
						//	event.preventDefault(); 
							
  							var myClass = $(this).parent().attr("class");							

							var parent=$(this).parent().parent();
  							
							$(this).parent().remove();
							date_pending[myClass]--;
							if 	(date_pending[myClass]==0)
							{

  								parent.find("."+myClass).each(function(){
  									//alert
  									$(this).remove();
  								});
  								lastdate=new Date("01/01/1001");
  							}
							/*$(this).parent().remove();
								count_pending--;
								console.log(count_pending);
							if (count_pending==0)
								$('#resultMsg').html("");*/
							return false;
					});


					$("input[name=transType]",'#radioBtns').bind( "click", function(event, ui) {
  							//alert("test");
  							$("#track_area").focus();
					});


					$("input[name='chkRecurring']").bind( "click", function(event, ui) {
					 		alert("test");
					});

					$(".links").click(function(event){
						//alert("test");
							event.preventDefault(); 
						
							var text= $('#track_area').val();
							//alert(text+" "+$('#track_area')[0].title);
							var lastSymbol="";

							 if ($('#track_area').val() == $('#track_area')[0].title)
			        		 {
			            		$('#track_area').removeClass("defaultTextActive");
			            		$('#track_area').val("$0.00");
			            		text="$0.00";
			        		 }

			        		if ($('#track_area').val().indexOf($(this).attr("name"))>-1)
					 			{
					 				$("#errorMsg").text("You can't enter "+$(this).attr("name")+" more than once");
					 				event.preventDefault();
					 				return;
					 			}
 	



			        		symbols[symbol]=0;
			        		lastSymbol=symbol;
			       			symbol=$(this).attr("name");


			       			//if text.index

					 		symbols[symbol]=text.length-1;
					
						//	alert(symbol);
							
							if ((symbol!="+") && (symbol!="-"))
							{
								if ((text.charAt(text.length-1))!=" ")
									text=text+" ";					
								text=text+symbol;
							}
							//else
							//	text=text+symbol+"0.00";
							
							
								$('#track_area').focus();
	    						$('#track_area').val(text);
	    					
								if (symbol=="#")
			    				{
			    			

			    									turnAutoOn();
			    									populateList(symbol);
			    									//alert("test");
			    				}
			 	   				trackInput();
							
							//return false;

					});
					$("#add").click(function(event){
						event.preventDefault();
						//alert("test1");
						enterToSave();
						//alert("test");
						return false;
					});

					$("#deleteBtn").click(function(event){
						event.preventDefault();
						//alert("test1");
						//enterToSave();
						switchOffTextScreen();
						//alert("test");
						return false;
					});
					function enterToSave()
					{
						
						var text=$('#track_area').val();
						if ((text!=""))
						{
							entertoPending(text);
							//alert(+" enter pending");
					
						}

						text=$('#track_area').val();
						//alert(text+"a");
						//alert(trimString($("#resultMsg").text())+" "+);

						if (trimString($("#resultMsg").text())!="")
						{	
							if ((text=="") || ($("#track_area")[0].title==text)  || (text=="$0.00") )
							{
							//	if ((text== ) &&()!=""))
								{
									saveTrans();		
									clear();
									switchOffTextScreen();

									/*$.mobile.changePage( "index.html", {
														transition: "slideup",
												reverse: true,
													
									});*/
								}
							}
						}						
					}


				/************ save transaction *******************/
				function saveTrans()
				{
					//$("#re")
					var results=$("#resultMsg");
					//console.log(results);
					results.children('div').each(function(){
						var insertDate=$(this).attr("class");
						var trans=$(this).text();
						if (trans.charAt(1)!="O")
						{
							var data=decompose(trans);

							var now = new Date();
							var curr_hour = now.getHours()+"";
							var curr_min = now.getMinutes()+"";
							var curr_sec = now.getSeconds()+"";
							
							if (curr_min.length == 1)
						   	{
						   	curr_min = "0" + curr_min;
						   	}
						   //	alert(curr_min.length+" "+curr_min);
						   	if (curr_hour.length == 1)
						   	{
						   	curr_hour = "0" + curr_hour;
						   	}
						   	if (curr_sec.length == 1)
						   	{
						   	curr_sec = "0" + curr_sec;
						   	}
  
							var created_at=insertDate+" "+curr_hour+":"+curr_min+":"+curr_sec;
						
							data['createdDate']=created_at;
							var recurType=$("#selectRecurring").val();
							data['recurring']=recurType;
							//alert(recurType);
							//searchCatsByName(db,"");
						//	tst();
							db.transaction(function(db)
				 				   {
				 				   		catFindIdName(db,data);
				 				   		//alert("test");
				 				  	 	//searchCatsByName(db,string);
				 				  	
				 				    },errorDB,function()
				 				    		  {  	
				 				    			//alert("success");
				 				    		  	//refreshDashboard();

				 				    		  	loadAllCats();
				 				    		  	loadAllDashboard();
				 								initTransDetails();	
				 				    		  	//updateChart(data['cat']);
				 				    		  	SYNCDATA.synServer(function(){
													alert("sync complete");
												})
				 				    		  	
				 				    		  }  
				 				    );

							
						} 
						//alert(childrenClass+);
						//var =



					})

				}
				function loadAllCats()
				{
						db.transaction(function(db)
								{
									getCats(db,cat);
								},errorDB,function(){


									all_cat_static=cat.results;

									//alert(search_results.length+" search results");

								});		
				}
				function loadAllDashboard()
				{

					var now=new Date();
					var firstday = now.getFullYear()+ "-" + (now.getMonth()+1)+ "-"+"01";
					var lastday = now.getFullYear() + "-" + (now.getMonth()+1)+ "-"+now.getDate();
					//alert(firstday+" "+lastday);
					//convertDatetimeToString(inputDate)

					listTrans(db,firstday,lastday,function(trans){

						//alert(trans.length);
						var cats=new Object();
						var catNoTransactions=new Object();
						db.transaction(function(db){
											//alert(trans.length);

											cats.results= new Array();
											getTotalBalance(db,trans,cats);
											
										//	getTotalBalance(db,cats);
											catNoTransactions.results = new Array();
											getNoTransactionCat(db,trans,catNoTransactions);
											
										//	get_cats_balance(db,cats);
										},errorDB,function(){

											//var trans=
											//alert("test"+cats.results.length);
											//alert(cats[0]);

											var spent=0,left=0;
											cats.results=cats.results.concat(catNoTransactions.results); 
										//	alert(cats.results[0].budget.budget_limit+" limit");
											//alert(value.spent+" "+value.left);
											$("#allcats").html("");
											for (var i=0;i<cats.results.length;i++)
											{
												var aCat=cats.results[i];
												//alert(cats.results[i].totalSpend+" "+cats.results[i].name+" "+aCat.budget.budget_limit);
												spent+=cats.results[i].totalSpend;
												//alert(spent);
												//alert(spent+ " "+left);
												$("#allcats").append("<div id='"+cats.results[i].name+"'></div><div style='clear:both'></div>");
												//alert(cat.name);
												var isBudget=0,budgetValue=0;
												if (cats.results[i].budget!=-1)
												{
													isBudget=1;
													budgetValue=cats.results[i].budget.budget_limit-cats.results[i].totalSpend;
													left += (cats.results[i].budget.budget_limit-cats.results[i].totalSpend);
												}
												$("#"+cats.results[i].name).barChart(
													{
													'id'         : cats.results[i].name,
								      				'color1'	 : '#993333',
								      				'color2'	 : '#339900',
								      				'value1'	 : cats.results[i].totalSpend,
								      				'value2'	 : budgetValue,
								      				'isBudget'   : isBudget
													}
												);
												$("#"+cats.results[i].name).data('barChart').init();
											
											}
											showChart("balance", "#993333","#339900",spent,left);
										
										}
									 );
					});
				/*	*/
							/*showChart("Food", "#993333","#339900",10,20);
							showChart("Groceries", "#993333","#339900",130,80);*/
				}

				function findLastSign(string)
				{
					for (var i=string.length-1; i>=0;i--)
    				{
    					if ((string.charAt(i)=="#")||(string.charAt(i)=="$")||(string.charAt(i)=="~")||(string.charAt(i)==" "))
    				
    					return i; 
    				}
    				return string.length;
				}

				function findNextSign(pos,string)
				{
					for (var i=pos; i<string.length;i++)
    				{
    					//alert(string.charAt(i));
    					if ((string.charAt(i)==" ")||(string.charAt(i)=="#")||(string.charAt(i)=="$")||(string.charAt(i)=="~"))
    					return i; 
    				}
    				return string.length;
				}

				function decompose(trans)
				{

					var data=new Object();
					trans= trimString(trans);
					//alert(trans);
					var string,amount="",cat="",opt="";



					var postSign= trans.indexOf("$");
					string=trans.substring(postSign+1,trans.length);

					var postNextSign= findNextSign(0,string);
					var amount=string.substring(0,postNextSign);
					//console.log(amount);

					var postHash= trans.indexOf("#");
					string=trans.substring(postHash+1,trans.length);
					postNextSign= findNextSign(0,string);
					var cat =string.substring(0,postNextSign);
					//console.log(cat);				

					var postOpt= trans.indexOf("~"),opt;
					if (postOpt>-1)
					{	
						string=trans.substring(postOpt+1,trans.length);
						//postNextSign= this.findNextSign(0,string);
						var opt =string;
						//console.log(opt);				
					}
					else 
						opt="";


						data['amount']=parseFloat(amount);
						//alert(amount);
						if (trans.charAt(0)=="-")
							data['amount']=-data['amount'];
						//alert(data['amount']);
						data['cat']=cat.toLowerCase();
						data['opt']=opt;

					
					
					return data;
				}
			


				function populateList(symbol)
				{
						var text= $('#track_area').val();	
					
						processKey(symbol,text);
						//alert(symbol);


    			
				}

				function clearSuggestList()
				{
					var sugList = $("#suggestions");
   					sugList.html("");
    				sugList.listview("refresh");

				}
				function processKey(symbol,text)
				{	
					//	alert(symbol+" "+text+"a");
							var position = text.indexOf(" ",text.indexOf(symbol));
							    								
    								position = text.length;
    								string= text.substring(text.indexOf(symbol)+1,position);
    				//				alert(string+"a");
    								//trimString(string);
    								var str="";
    							//	console.log(string);
    					//			alert(string);
    								if (trimString(string)=="")
    								{
    									//alert("test");
    									setListDefault();
    								}
    								else
    									searchStringInArray(trimString(string));
    								
    				//	return str;
				}

				function searchStringInArray (string) {
					search_results=new Object();
			 		search_results.result=new Array();
				//	search_result()
					str="";
					db.transaction(function(db)
				 				   {
				 				   		search_results=new Object();
			 							search_results.result=new Array();
				 				   		//alert("test");
				 				  	 	searchCatsByName(db,string,search_results);
				 				  	
				 				    },errorDB,function()
				 				    		  {  	
				 				    		  	str="";
				 				    		  	var sugList = $("#suggestions");
				 				    		  	for (var i=0, len=search_results.result.length;i<len;i++)
    											{
    												str += "<li data-icon='false' title='"+search_results.result[i]+"''><a style='font-size:12px'>" +search_results.result[i] +"</a></li>";
    											}

    											if (search_results.result.length==0)
    											{
													str += "<li data-icon='false' title='not found'><a style='font-size:12px'>not found</a></li>";
    				    						}

    											//alert(str);
    											sugList.html(str);
    											sugList.listview("refresh");
				 				    		  }  
				 				    );
									
				   /* for (var j=0; j<stringArray.length; j++) {
				        if (stringArray[j].match (string)) 
				        	{
				        		search_results.push(stringArray[j]);
				        		//alert(stringArray[j]);
				        	}
				        	

				    }*/
				    return search_results;
				}
					/*validation*/
				function isNumber(n) {
				  return !isNaN(parseFloat(n)) && isFinite(n);
				}
				function stringValidate(string)
				{

						string=trimString(string);
						//console.log(string);
						var msg="";
					//	var symbols= ["+","-","#"];
						var text=string;
						var posPlus= text.indexOf("+");
						var posMinus=text.indexOf("-");
	    				var posSign=0;
	    				var posHash=0;

	    			/*	if 	((posPlus*posMinus >0) && (posPlus+posMinus==-2))
	    				{
	    					msg+='Enter either "+" or "-"<br>';
	    				}*/
	    				//console.log(posPlus);
	    				//console.log(posMinus);

	    				if (trimString(string) == trimString($("#track_area")[0].title))
						{ 
							//alert(string);
							return "Transaction can't be blank";
						}
						
						posSign= text.indexOf("$");
					
	    				if (posSign>=0)
	    				{
	    					var amount= text.substring(posSign+1,text.length);
		    				var charCut=text.length;
		    				if (amount.indexOf(" ")>-1)
		    				{
		    					charCut=amount.indexOf(" ");
		    				}
		    				//alert(charCut);
		    				if ((amount.indexOf("#")< charCut) && (amount.indexOf("#")>-1))			
		   						charCut=amount.indexOf("#");
		   					//if (charCut=-1)
		   					if (charCut>-1)
		    					amount=amount.substring(0,charCut);
		    				//alert(amount+" "+charCut);


		 					if (isNumber(amount)==false)
		 						msg+="Amount is not a number <br>";
		 					if (amount=="0.00")
		 						msg+="Amount must not be zero <br>";
	    				}
	    				else
	    						msg+="Enter the currency ($) <br>";		

	    				posHash= text.indexOf("#");
	    				if (posHash==-1)
	    				{
	    					msg+= "Enter a category starts with #<br>";
	    				}
	    				else
	    					{
		    					var category= text.substring(posHash+1,text.length);
			    				if (category.indexOf("~")>-1)
			    				{
			    					category=category.substring(0,category.indexOf("~"));
			    				}
			 					if (category=="")
			 						msg+= "Category cannot be blank<br>";
		 					}	

	    	
						return msg;
				}

				function trimString (str) {
					    str = str.replace(/^\s+/, '');
					    for (var i = str.length - 1; i >= 0; i--) {
					        if (/\S/.test(str.charAt(i))) {
					            str = str.substring(0, i + 1);
					            break;
					        }
					    }
					    return str;
					}


				function enterNumber(last_char)
				{
					if (isNumber(last_char))
					{
						
						trackDecimal++;
					//	if ((trackDecimal==1) && (last_char=="0"))
					//		trackDecimal--;
						//alert(trackDecimal);
						//alert(last_char);
						var text=$("#track_area").val();
						//alert(text);
						$('#track_area').val("");
		    		
						var pos=findNextSign(1,text);
						var afternumber="";
					
						if (pos!=text.length)
							afternumber=text.substring(pos,text.length);
						
							
						//alert(afternumber);
					
						text=text.substring(0, pos);
						//alert(afternumber);
					//	alert(text);
		    			if (trackDecimal<=2)
		    			{
		    				//text=text.substr(0,text.length-1);
		    				//console.log(text+" before text");
		    				var previousLastChar = text.substr(text.length-1,1);
		    				//console.log(text+" previousLastChar");
		    				//alert(previousLastChar);
		    				final_text= text.substr(0,text.length-2);
		    				//alert(final_text);
		    				//console.log(text+" previousLastChar");
		    				final_text+= previousLastChar + last_char;
		    				
		    			
		    			}
		    			else
		    			{
		    				text=text+last_char;
		    				//console.log(text);
		    			//	alert(trackDecimal);
		    				//text=text.substr(0,text.lengthgth-1);
		    				var decimal_portion=text.substr(text.length-2,2);
		    		//		alert(decimal_portion+" decimal");
		    			

		    				var digit=text.substr(0,text.length-2);
		    			//	alert(digit);
		    				if (trackDecimal==3)
		    				{
		    				//	alert("test");
		    					var number=digit.substr(digit.length-1,1);

		    					digit=digit.substring(0,digit.indexOf('0'))+number;
		    			//		alert(digit);
		    					//var number=;
		    					//alert(number);
		    					//number=+number;
		    					//alert(number);
		    				}
		    				else
		    					digit=digit.replace(".","");
		    				//alert(digit+" digit");
		    				final_text=digit+"."+decimal_portion;
									    								

		    			/*	if (last_char==0 && trackDecimal==3)
		    				{
		    					trackDecimal--;
		    				}
		    				else
			    			{
			    				if (trackDecimal==3)
			    				{
			    					final_text= text.substr(0,text.length-4);	
			    				}
			    				else
			    					final_text= text.substr(0,text.length-3);
			    				
			    				final_text += last_char+decimal_portion; 
		    				}*/
		    				//$('#track_area').val("");
		    			}
		    			final_text+=afternumber;

		    			$('#track_area').val(final_text);
		    			text=$('#track_area').val();
		    			//$('#track_area').setCursorPosition(pos);
		    			pos=findNextSign(text.indexOf("$")+1,text);
    					$('#track_area').setCursorPosition(pos);
		    			//$('#track_area').selectRange($('#track_area').val().length,$('#track_area').val().length);
		    			//alert("test");
		    			//setCaretToPos($('#track_area'), $('#track_area').val().length-1);

					}
					else
						$('#errorMsg').html("Enter Number Only");
									
				} 

				/*******************************************/    		
					$("#showScroller").click(function(event){
						event.preventDefault();
						$("#scroller").scroller("show");
						return false;
					});

			
	

			//	stringValidate(" - 100.3e rewqrqw #");

				function clear()
				{
					turnAutoOff();
					$("#resultMsg").html("");
					$("#errorMsg").html("");
					lastdate=new Date("01/01/1001");
					last_word="",
					symbol="$";
					trackDecimal=0;
					date_pending=new Object();	

					var cat=new Object();
						cat.results=new Array();
						db.transaction(function(db)
								{
									getCats(db,cat);
								},errorDB,function(){
									search_results=cat.results;
									//alert(search_results.length+" search results");

								});						
				}

				function switchOnTextScreen()
				{
					//disable top
					$("#profile").hide();
					//enable nav link
					$("#functionBarTime").show();
					$("#functionBar").show();
					$("#todayTxt").text("E.g: $10 #food or $20 #groceries ~optional text");
					$.mobile.silentScroll(0);
					$("#add").show();
					$("#deleteBtn").show();
					//add button
				} 
				function switchOffTextScreen()
				{
					//after save data 
					//disable nav link
					//enable title 
					//refresh chart
					$("#profile").show();
					//enable nav link
					$("#functionBar").hide();
					$("#functionBarTime").hide();
					$("#todayTxt").text("Today's transaction");
					$("#add").hide();
					$("#deleteBtn").hide();
			
					//return
					//hide button

				}

				

				function populateRecurring()
				{
					$("#selectRecurring").html("");
					var selectRecurring=$("#selectRecurring");	
					selectRecurring.selectmenu();
					var recurring= ['Never','Daily','Weekly', 'Monthly', 'Yearly'];
					for (var i=0;i<recurring.length;i++)
					{
						var aRecurr= '<option value="'+(i)+'">'+recurring[i]+'</option>';
						selectRecurring.append(aRecurr);
					}
					selectRecurring.selectmenu('refresh');

					selectRecurring.bind("change",function(event,ui){
							$('#track_area').focus();
							event.stopImmediatePropagation();
					})
				}

				$("#track_area").focus(function(srcc)
			    {
			        if ($(this).val() == $(this)[0].title)
			        {
			            $(this).removeClass("defaultTextActive");
			            $(this).val("$0.00");
			            symbol="$";
			        }
			        switchOnTextScreen();
			     	//$("#track_area").focus();   
			       //
			      

			    });
			    
			    $("#track_area").blur(function()
			    {
			        if (($(this).val() == "")|| ($(this).val() == "$0.00"))
			        {
			            $(this).addClass("defaultTextActive");
			            $(this).val($(this)[0].title);
			        }
			    });

			    (function ($, undefined) {
				    $.fn.getCursorPosition = function() {
				        var el = $(this).get(0);
				        var pos = 0;
				        if('selectionStart' in el) {
				            pos = el.selectionStart;
				        } else if('selection' in document) {
				            el.focus();
				            var Sel = document.selection.createRange();
				            var SelLength = document.selection.createRange().text.length;
				            Sel.moveStart('character', -el.value.length);
				            pos = Sel.text.length - SelLength;
				        }
				        return pos;
				    }
				})(jQuery);


			});
         
			/****************Helper *******************************/

			function capitaliseFirstLetter(string)
			{
			    return string.charAt(0).toUpperCase() + string.slice(1);
			}

			new function($) {
			  $.fn.setCursorPosition = function(pos) {
			    if ($(this).get(0).setSelectionRange) {
			      $(this).get(0).setSelectionRange(pos, pos);
			    } else if ($(this).get(0).createTextRange) {
			      var range = $(this).get(0).createTextRange();
			      range.collapse(true);
			      range.moveEnd('character', pos);
			      range.moveStart('character', pos);
			      range.select();
			    }
			  }
			}(jQuery);

			function abbrNum(number, decPlaces) {
			    // 2 decimal places => 100, 3 => 1000, etc
			    decPlaces = Math.pow(10,decPlaces);

			    // Enumerate number abbreviations
			    var abbrev = [ "k", "m", "b", "t" ];
			    var i=-1;
			    // Go through the array backwards, so we do the largest first
			    for (i=abbrev.length-1; i>=0; i--) {

			        // Convert array index to "1000", "1000000", etc
			        var size = Math.pow(10,(i+1)*3);

			        // If the number is bigger or equal do the abbreviation
			        if(size <= number) {
			             // Here, we multiply by decPlaces, round, and then divide by decPlaces.
			             // This gives us nice rounding to a particular decimal place.
			             number = Math.round(number*decPlaces/size)/decPlaces;

			             // Handle special case where we round up to the next abbreviation
			             if((number == 1000) && (i < abbrev.length - 1)) {
			                 number = 1;
			                 i++;
			             }
			            

			             // We are done... stop
			             break;
			        }
			    }
			     number=parseFloat(number).toFixed(2);

			             // Add the letter for the abbreviation
			             if (i>-1)
			             number += abbrev[i];

			    return number;
			 }

			 function daysInMonth() {
			 	var now = new Date();
			 		var month = now.getMonth()+1+"";
			 		var year = now.getFullYear()+"";
			 		var current_date= now.getDate();
			 		//alert (current_date);
			 		//alert ((new Date(year, month, 0).getDate())+"");
				    return (new Date(year, month, 0).getDate())-current_date;
				}
			function extractDateFromDatetime(date)
			{
				var tmp=date.split('-');
				return tmp[2];
			}

			function formatDate(date)
			{
				//var aDate= new Date(date);
				//alert("test");
				var today= new Date();
				var yest_date = today.getDate()-1+"";
				var curr_date = today.getDate()+"";
				var curr_month = today.getMonth()+1+"";
				var curr_year = today.getFullYear()+"";
				var today_date = curr_year+"-"+curr_month+"-"+curr_date;
				//alert(today_date);
				if (today_date==date)
					return "Today"
				else
					if ((curr_year+"-"+curr_month+"-"+yest_date)==date)
						return "Yesterday"
					else
					{
						var array=date.split("-");
						return array[2]+"-"+array[1]+"-"+array[0];
					}
					
			}
			function process_seven_days(data)
			 {
			 	//alert("test");
			 	var date=new Array();
			 	var object=new Object();
			 	object.date = "";
			 	object.amount = 0;
			 	//date=data[0].created_at;
			 	//alert(data[0].amount);
			 	var final_date=new Array();

			 	for (var i=6; i>=0;i--)
			 	{
			 		//alert("test");
			 		var aDate= new Date();
			 		aDate.setDate(aDate.getDate()-i);
			 		var curr_date = aDate.getDate()+"";
					var curr_month = aDate.getMonth()+1+"";
					var curr_year = aDate.getFullYear()+"";
				//	final_date[]=0;
					var key=curr_year + "-" + curr_month + "-" + curr_date;
					final_date[key]=0;
					//alert(final_date[key]);
			 	}
			 

			 	for (var i in data)
			 	{

			 			var datetmp=data[i].updated_at+"";
			 			var dateArray = datetmp.split("-");
			 			var cyear=dateArray[0];
					 	var cmonth=dateArray[1];
			 			var cdate=dateArray[2].substring(0,dateArray[2].indexOf(" "));
			 			//alert(data[i].amount+" "+final_date[cyear+ "-" + cmonth + "-" + cdate]);
			 		   	final_date[cyear+ "-" + cmonth + "-" + cdate]+=data[i].amount;
			 		   //	alert(cyear+ "-" + cmonth + "-" + cdate+" "+final_date[cyear+ "-" + cmonth + "-" + cdate]);
			 		   // console.log(cyear);
			 			/*if (object.date !=data[i].created_at)
			 		{
			 			object=new Object();
			 			object.date=data[i].created_at;
			 			object.amount=0;
			 			date.push(object);
			 			//alert(object)
			 		}*/
			 		//alert(data[i].amount);
			 		//date[date.length-1].amount+= data[i].amount;
			 		//console.log(date[date.length-1].date+" "+date[date.length-1].amount);
			 	}
			 	return final_date;
			 	//console.log(date.length);
			 }
			 function noDaysInMonth(month,year) 
			{
			   return new Date(year, month, 0).getDate();
			}
	
			function convertUnixToString(unix_timestamp)
			{
				var date = new Date(unix_timestamp*1000);
				return convertDatetimeToString(date)
				// hours part from the timestamp
				/*var year = date.getFullYear();
				// minutes part from the timestamp
				var month = date.getMonth();
				// seconds part from the timestamp
				var day = date.getDate();

				// will display time in 10:30:23 format
				return year + '-' + (month+1) + '-' + day;*/
			}

			function convertToUnixTime(yourDate) {

			    var tmp=yourDate.split("-");
			   	var tmpDate = new Date(tmp[0],tmp[1]-1,tmp[2]);
				return tmpDate.getTime()/1000.0;									
			}



			function convertDatetimeToString(inputDate)
			{
				var now = inputDate;

				var curr_date = now.getDate()+"";
				if (curr_date.length==1)
					curr_date="0"+curr_date;
				var curr_month = now.getMonth()+1+"";
				if (curr_month.length==1)
					curr_month="0"+curr_month;
				var curr_year = now.getFullYear()+"";

				//alert(curr_date);

			   	return curr_year + "-" + curr_month + "-" + curr_date;
			 }

			function timeNow()
			{
				var now = new Date();

				var curr_date = now.getDate()+"";
				var curr_month = now.getMonth()+1+"";
				var curr_year = now.getFullYear()+"";
				var curr_hour = now.getHours()+"";
				var curr_min = now.getMinutes()+"";
				var curr_sec = now.getSeconds()+"";


				if (curr_min.length == 1)
			   	{
			   	curr_min = "0" + curr_min;
			   	}
			   //	alert(curr_min.length+" "+curr_min);
			   	if (curr_hour.length == 1)
			   	{
			   	curr_hour = "0" + curr_hour;
			   	}
			   	if (curr_sec.length == 1)
			   	{
			   	curr_sec = "0" + curr_sec;
			   	}
			   	return curr_year + "-" + curr_month + "-" + curr_date+" "+curr_hour+":"+curr_min+":"+curr_sec;
			}
			function preload(arrayOfImages) {
			    $(arrayOfImages).each(function(){
			        $('<img/>')[0].src = this;
			        // Alternatively you could use:
			        // (new Image()).src = this;
			    });
			}
			function refreshPage() {
			  $.mobile.changePage(
			    window.location.href,
			    {
			      allowSamePageTransition : true,
			      transition              : 'none',
			      showLoadMsg             : false,
			      reloadPage              : true,
			      changeHash			  : false
			    }
			  );
			}


			/****************************************/
        }
	</script>
	</head>
	<body>

		<div data-role="page" id="home">

			<div data-role="header" data-theme="b" style="height:30px;">
				<a id="deleteBtn" data-icon="delete" data-inline="true"  data-mini="true" data-iconpos="notext" data-rel="back"  style="margin-top:-3px; display:none">Delete</a>
				
				<h1>Budgit</h1> <!--data-rel="dialog"-->
				<!--<a href="#addPage"  data-icon="plus"  class="ui-btn-right" style="margin-top:-3px" data-inline="true" data-iconpos="notext" data-transition="slideup" >Add</a> -->
				<a id="add" data-icon="plus"  data-inline="true"  data-mini="true" class="ui-btn-right" data-iconpos="notext" style="margin-top:-3px; display:none">Post</a>
				
							
			</div>
			<!-- /header -->
			<div data-role="content" style="padding:0px 0px 0px 0px;">
				<div id="profile" style="height:80px; background-color:gray;color:white;padding:5px 0px 5px 10px;" class="ui-body ui-body-a">
						<div style ="overflow: hidden;width: 100%;">
							<div class="profilePicture">
								<img src='img/vicbui.jpg' width='70px' height='70px' style="padding-bottom:0px"/>
							</div>

							<div style="padding:5px 0px 0px 10px;float:left;">
								<h4 style="padding:0px 0px 0px 0px;margin:0px 0px 0px 0px">Vic Bui </h4>
						


						<!--<div class="ui-grid-a" style="width:200px">
								<div class=" ui-block-a">
									<div style="height:30px;width:55px; background-color:blue; text-align:center;" class="ui-body  badgeRed">
									$40
										<div style="font-size:11px;padding-top:0px;margin-top:0px;margin-left:">Remaining</div>
									</div>
								</div>
								<div class="ui-block-b">
									
									<div style="height:30px;width:55px; background-color:blue; text-align:center;" class="ui-body ui-corner-all badgeGreen">
									$100
										<div style="font-size:11px;padding-top:0px;margin-top:0px;margin-left:0px">Balance</div>
									</div>
								</div>
							</div>
						-->
							<div style="padding-top:5px;margin-left:0px">

									<div style="font-size:14px;color:white;font-weight:bold;z-index:100;float:left;width:45px;text-align:center"> <div id="barChartbalanceS" >$13 </div>
											<div style="font-size:11px;font-weight:bold;">Spent</div>
									</div>
									<div style="float:left;width:120px" class="bigChart">
										<div id="barChartbalance" style="height:50px;width:120px;z-index:0;margin-left:-3px;margin-top:-10px;float:left">
											</div>
									
											
									</div>

									<div style="margin-top:0px;font-size:14px;color:white;font-weight:bold;z-index:100;float:left;width:50px;text-align:center"><div id="barChartbalanceL" >$15 </div>
											<div style="font-size:11px;padding-top:0px;margin-top:0px;font-weight:bold;">Left</div>
									</div>

								
							</div>
						</div>
					</div>

				</div>
					

					<div id="transmain" style="font-size:11px;color:dark-gray; padding:0px 5px 0px 5px;">
											<div id="todayTxt">
												Today's transaction :	
											</div>

					
										

										
											<input type="text" id="track_area" class="defaultTextActive" title="E.g: $10 #saving" value="E.g: $10 #saving" data-prevent-focus-zoom="true"></input>
								<div id='position' style="text-align:center"><em id="0" class='on nav'>&#x25cf</em><em id="1" class='nav'>&#x25cf</em></div>
					<div  class='swipe'>
						<div>
							 <div style='display:block'>
											<div id="functionBar" style="display:none">
												<div style="font-size:11px;color:dark-gray; padding-bottom:0px;" id="instructionTxt">
													<div class="navlink ui-grid-a" data-role='none'>
															

															<div class="ui-block-a scrollable" id="resultMsg" style="text-align: left;height:50px"></div>
															
															<div class="ui-block-b scrollable" id="errorMsg"  style="color:red;text-align:left;height:50px">
																	
															</div>
													</div>
												</div>

												
												<ul id="suggestions" data-role="listview" data-inset="true" class="scrollable" style="display:none"> </ul>




												<div id="functionBarTime" style="padding-bottom:0px;display:none;overflow:hidden">
													<fieldset data-role="controlgroup" data-mini="true" data-type="horizontal" id="radioBtns" style="float:left;width:40%;padding-top:10px">
														
															<input type="radio" name="transType" id="radioIncome" value="+" style="font-size:10px; height:0px" />
														 	<label for="radioIncome" class="radiobtn" >Income</label>


															<input type="radio" name="transType" id="radioExpense" value="-" checked="true" style="font-size:10px; height:0px"/>
															<label for="radioExpense" class="radiobtn">Expense</label>

																								
													</fieldset>	
												<!--	<fieldset data-role="controlgroup" data-mini="true" class="chkcontrol" data-type="horizontal">
																														
															<input type="checkbox" name="chkRecurring" id="chkRecurring" class="custom" />
															<label for="chkRecurring">Recurring</label>
																								 
													</fieldset> -->
													<div style="float:right;padding-bottom:5px;width:100px">
												        <select name="selectRecurring" id="selectRecurring" data-theme="c" data-mini="true"  >
												        	<option value="-1">Recurring</option>
												        </select>
												    </div>
												</div>

												<div style="background-color:lightgray; height:25px;" >

													<div class="navlink" data-role='none'>

														<div style="width:100%;float:left">
																
																<a class="links" data-role='none' name="#" href="#" style="float:left;width:20%;"># </a> 
																
																<a class="links" data-role='none' name="~"  href="#" style="float:left;width:5%;">~ </a>
																

																<div class="navlink" style="text-align: right; margin-top:3px;padding-right:10px;float:left;width:30%;">
																	<input id="scroller" name="scroller" style="display:none;" />
																	<a href="#" id="dateLnk" style="font-size:16px;color: gray;" >
																		12-20-32
																	</a>
																</div>



														
																	<!-- <div class="ui-block-a">	
																		<a class="links" data-role='none' name="+" href="#">+ </a></div>
																	<div class="ui-block-b">	
																		<a class="links" data-role='none' name="-" href="#">- </a>
																	</div> -->

															
														</div>
														<!--<div class="ui-block-b">
															<div class="ui-grid-a">
																						</div>
														-->
													</div>
														
														 
												</div> 
											</div>

												<div id="allcats">
												</div>

											
										</div>

							<!--<div style="padding-top:5px;margin-left:0px">
									<div style="font-weight:bold;z-index:100;float:left;width:45px;text-align:center"> <div id="barChartFoodS" >$13 </div>
											<div style="font-size:11px;font-weight:bold;">Spent</div>
									</div>
									<div style="position:relative;float:left;width:220px" class="smallChart">
										<div id="barChartFood" style="height:50px;z-index:0;margin-left:-3px;margin-top:-10px;float:left">
										</div>

										<div id="barChartName" style="position:absolute;top:5px;left:100px;font-weight:bold;z-index:100;width:50px;text-align:center; color:white">
												Food
										</div> 
										
											
									</div>
									<div style="margin-top:0px;font-weight:bold;z-index:100;float:left;width:50px;text-align:center">
											<div id="barChartFoodL" >$15 </div>
											<div style="font-size:11px;padding-top:0px;margin-top:0px;font-weight:bold;">Left</div>
									</div>
							</div>-->

				



		<!--Transaction details page-->
				<div style='display:block'>

					<div data-role="popup" id="popupDelete" data-theme="a">
								    	  
							<div style="padding:10px 10px;">
								<h4>Delete the repeating expense</h3>
								<span style="display:none" id="deleteTransDate"></span>	
								<span style="display:none" id="deleteTransId"></span>
								<a href="#" data-role="button" data-theme="b" id="0" class="recurringDelete">Just this expense</a> 
								<a href="#" data-role="button" data-theme="b" id="1" class="recurringDelete">This expense and stop repeat</a> 
								<a href="#" data-role="button" data-theme="b" id="2" class="recurringDelete">All repeats of this expense</a> 
								<a href="#" data-role="button" data-theme="b" id="3" class="recurringDelete">Cancel</a> 
							</div>

					</div>							
					<div id="transDetails">

												
													<div style="text-align:center">
															
														<div data-role="collapsible-set" data-theme="c" data-content-theme="d" data-collapsed-icon="arrow-r" data-expanded-icon="arrow-d" data-inset="true" class="list">
														
															
															<!--<div data-role="collapsible">
																<h2 data-icon="false">
																	<span style="float:left">23 OCT 2012</span>
																	<span style="float:right" class="ui-li-count"> (2) </span>
																	<span style="float:right">$200</span>
																	
																</h2>
																<ul data-role="listview">
																	<li data-icon="false">
																			<span style="float:left">$100</span>
																			<span style="float:right">10:34 </span>			
																	</li>
																    <li data-icon="false">$30</li>
																
																</ul>
															</div>	-->
														</div>


														<!--<a class="loadmore" href="#" >Load more... </a>-->
										
													</div>
					 						</div>
					

					</div>
				</div>
			</div>
		 </div>

	 </div>
			<!-- /content -->

   </div>
		<!-- /page -->


		<!-- /page -->		

		<!--page track -->

	<!--<div data-role="page" id="transactionDetails">
							This is a completely basic popup, no options set.
						</div>-->

		<div data-role="page" id="cat">
		
			<div data-role="header" data-theme="b" style="height:30px;">

				<a data-icon="delete" data-inline="true"  data-mini="true" data-iconpos="notext" href="index.html" style="margin-top:-3px">Delete</a>
				<h1 style="margin-top:4px">Budgit</h1>
				<a id="add" data-icon="plus"  data-inline="true"  data-mini="true" class="ui-btn-right" data-iconpos="notext" style="margin-top:-3px">Post</a>
				
			</div>
			<!-- /header -->

			<div data-role="content" style="padding:0px 0px 0px 0px;">
				<div data-role="popup" id="popupDeleteCat" data-theme="a">
								    	  
							<div style="padding:10px 10px;">
								<h4>Delete the repeating expense</h4>
								<span style="display:none" id="deleteTransDate"></span>	
								<span style="display:none" id="deleteTransId"></span>
								<a href="#" data-role="button" data-theme="b" id="0" class="recurringDelete">Just this expense</a> 
								<a href="#" data-role="button" data-theme="b" id="1" class="recurringDelete">This expense and stop repeat</a> 
								<a href="#" data-role="button" data-theme="b" id="2" class="recurringDelete">All repeats of this expense</a> 
								<a href="#" data-role="button" data-theme="b" id="3" class="recurringDelete">Cancel</a> 
							</div>

					</div>	
				<div id="profileCat" style="height:80px; background-color:gray;color:white;padding:5px 0px 5px 10px;" class="ui-body ui-body-a">
						<div style ="overflow: hidden;width: 100%;">
							<div style="float:left;height:60px;width:60px;text-align:center;padding:5px" class="badgeBlue">
									<div id="dateLeft" style="font-size:40px">10</div> 
									<div style="font-size:12px">days left</div>
							</div>
							<div style="padding:5px 0px 0px 10px;float:left">

								<h4 style="padding:0px 0px 5px 0px;margin:0px 0px 0px 0px" id="catTitle">Food </h4>
								<div style="float:left;padding-right:10px">
						
									<div id="total" style="padding-top:0px;margin-left:0px">

										<div style="font-size:14px;color:white;font-weight:bold;z-index:100;float:left;width:45px;text-align:center"> <div id="barCharttotalS" >$13 </div>
												<div id="barCharttotalSLabel" style="font-size:11px;font-weight:bold;">Spent</div>
										</div>
										<div style="float:left;width:120px" class="bigChart">
											<div id="barCharttotal" style="height:50px;width:120px;z-index:0;margin-left:-3px;margin-top:-10px;float:left">
												</div>
										
												
										</div>

										<div style="margin-top:0px;font-size:14px;color:white;font-weight:bold;z-index:100;float:left;width:50px;text-align:center"><div id="barCharttotalL" >$15 </div>
												<div id="barCharttotalLLabel" style="font-size:11px;padding-top:0px;margin-top:0px;font-weight:bold;">Left</div>
										</div>

									
										</div>
								</div>
							</div>
							
							
							
						</div>	
				</div>
				<div style="font-size:11px;color:dark-gray; padding:5px 5px 10px 5px">
						
						<div id="todayTxtCat">
							Today's transaction :	
						</div>

						<div style="float:left;font-weight:bold;font-size:16px;padding:16px 5px 0px 0px;text-align:center" type="text" id="catLbl" class="defaultTextActive" title="E.g: $10" value="E.g: $10" data-prevent-focus-zoom="true">#Food</div>

						<input style="float:left;max-width:70%" type="text" id="cat_track_area" class="defaultTextActive" title="E.g: $10" value="E.g: $10" data-prevent-focus-zoom="true"></input>
						<!-- <div style="font-size:13px;font-weight:bold;color:gray;text-align:center;clear:both">
							Monthly Summary 
						</div> -->
						<div class="ui-grid-a" style ="overflow: hidden;width: 100%;padding-bottom:5px">

							<div class="ui-block-a" style="padding-left:5px;margin-top:15px;" >
								<!--<div id="lineChart" style="height:200px;width:180px;font-size:16px;margin-left:-16px; margin-top:-5px"></div>
								<div class="legend" style="font-size:11px;color:gray;margin-top:-40px;z-index:100;height:20px;">
									<div id="legendLine" style="padding-left:2px;z-index:100">Food Expenses Last 7 days</div>
								</div>-->
								<div id="avgSpend" style="overflow:hidden;padding-bottom:15px">
									<div style="float:left;padding-right:5px;">
										<div style="height:43px;width:50px;text-align:center;" class="badgeBlue">
											<div id="amountMax" style="font-size:12px;padding-top:6px">$200.00</div> 
											<div style="font-size:10px;font-weight:normal">Max</div>
										</div>
										<div style="height:42px;width:50px;text-align:center;margin-top:3px" class="badgeBlue">
											<div id="amountMin" style="font-size:12px;padding-top:6px">$100.00</div> 
											<div style="font-size:10px;font-weight:normal">Min</div>
										</div>
									</div>
									<div style="float:left;height:90px;width:90px;text-align:center;vertical-align: middle;" class="badgeBlue">
										<div id="amountAvg" style="font-size:22px;padding-top:20px">$20.00</div> 
										<div style="font-size:12px">Average</div>
									</div>

								</div>
								<div id="legendLine" style="font-size:12px;color:gray;text-align:center; width:130px"> Spending This Month</div>
								
							</div>
							<div class="ui-block-b">
								<div id="donutChart" style="width:170px;height:170px;color:white;font-size:16px;margin-left:-15px;margin-top:-20px;padding-bottom:0px;z-index:0"></div>
									<div class="legend" id="legendPie" style="font-size:12px;color:gray;margin-top:-32px;z-index:100;height:20px; width:text-align:center; margin-left:20px;display:none">
										<div style="padding-left:2px;z-index:100">of Total Spending</div>
										<div id="valueDonutChart" style="z-index:1000;font-size:26px;color:gray;font-weight:bold;margin-top:-90px;margin-left:25px">18%</div>
									</div>
								
							
							</div>
							
						</div>
					
						<div style="padding-top:5px;padding-left:5px; text-align:center">
						
						<div data-role="collapsible-set" data-theme="c" data-content-theme="d" data-collapsed-icon="arrow-r" data-expanded-icon="arrow-d" data-inset="true" class="list">
						
							
						</div>
						<!--	<div data-role="collapsible">
								<h2 data-icon="false">
									<span style="float:left">23 OCT 2012</span>
									<span style="float:right" class="ui-li-count"> (2) </span>
									<span style="float:right">$200</span>
									
								</h2>
								<ul data-role="listview">
									<li data-icon="false">
											<span style="float:left">$100</span>
											<span style="float:right">10:34 </span>			
									</li>
								    <li data-icon="false">$30</li>
								
								</ul>
							</div>-->	
						<!--<a class="loadmore" href="#" >Load more... </a>-->
					
						</div>
					


							<!--	<ul data-role="listview" data-theme="d"  data-divider-theme="d">
									<li data-role="list-divider">Food Expenses
									  <span class="ui-li-aside"> OCT 2012</span> 
										<span class="ui-li-count">5</span>
									</li>
									<li><a href="index.html">
										
											$200
											<span class="ui-li-aside">Today</span> 
											<span class="ui-li-count">5</span>
										
										</a>
									</li>
									<li><a href="index.html">
											$200
											<span class="ui-li-aside">23 OCT 2012</span> 
											<span class="ui-li-count">2</span>
										
										
										</a>
									</li>
								</ul> -->
						</div>

									
				</div>

				
			</div>

		<!--Analytic -->

		<div data-role="page" id="analytic">
			<div data-role="header" data-theme="b" style="height:30px;">

				<a data-icon="delete" data-inline="true"  data-mini="true" data-iconpos="notext" data-rel="back"  style="margin-top:-3px">Delete</a>
				<h1 style="margin-top:4px">BudgIt Insight</h1>
				<a data-icon="search" data-inline="true"  data-mini="true" data-iconpos="notext" style="margin-top:-3px">search</a>
				
			</div>
			
			<div data-role="content" style="padding:0px 0px 0px 0px;">
			   <div id="profile" style="height:60px;overflow:hidden;;color:white;padding:8px 0px 5px 5px;" class="ui-body ui-body-a">
					<div id="timespan" style="font-size:12px;font-weight:bold;padding-bottom:2px;text-align:center;float:left">
						<!--<fieldset data-role="controlgroup" data-mini="true" data-type="horizontal" id="radioBtns" style="padding-top:5px">
						
							<input type="radio" name="transType" id="radioDate" value="+" style="font-size:10px; height:0px" data-theme="c"/>
							<label for="radioDate" class="radiobtnTime">Date</label>
							
							<input type="radio" name="transType" id="radioMonth" value="-" checked="true" style="font-size:10px; height:0px" data-theme="c"/>
							<label for="radioMonth" class="radiobtnTime">Month</label>

							<input type="radio" name="transType" id="radioYear" value="-" style="font-size:10px; height:0px" data-theme="c"/>
							<label for="radioYear" class="radiobtnTime">Year</label>
							
						</fieldset>-->
						<div>
							<div style="float:left" id="divselectDay">
						        	<select name="selectDay" id="selectDay" data-theme="c" data-mini="true">
						        	<option value="-1">All</option>

						        </select>
						    </div>
						    <div style="float:left">
						        <select name="selectMonth" id="selectMonth" data-theme="c" data-mini="true">
						        </select>
						    </div>
 						    <div style="float:left">

						        <select name="selectYear" id="selectYear" data-theme="c" data-mini="true">
						            <!-- etc. -->
						        </select>
						    </div>
						</div>
							<div id="divSelectCat">
							 	<select id="selectCat" data-theme="c" data-mini="true">
								   <option value="-1">All</option>
								</select>
					    	</div>
					</div>
	
					<div id="avgSpend" style="float:right;overflow:hidden;padding-right:10px">
						
						<div style="">
							<div style="float:left;height:50px;width:50px;text-align:center;vertical-align:middle;margin-top:0px" class="badgeRed">
								<div id="amountSpent" style="font-size:12px;padding-top:5px;font-weight:bold">$20.00</div> 
								<div style="font-size:10px">Spent</div>
							</div>	
						
							<!--<div style="float:left;height:50px;width:50px;text-align:center;margin-left:5px;margin-top:0px" class="badgeGreen">
								<div id="amountSave" style="font-size:12px;padding-top:5px;font-weight:bold">$20.00</div> 
								<div style="font-size:10px">Save</div>
							</div>-->
						</div>

					</div>
				</div>
				<div id='positionInsight' style="text-align:center"><em id="0" class='on navone'>&#x25cf</em><em id="1" class='navone'>&#x25cf</em><em id="2" class='navone'>&#x25cf</em></div>
				<div id='slider' class="swipe" style="margin-top:-10px">
					<div>
						<div style="display:block;text-align:center">
							<div class="chartEmpty" style="margin-top:10px;display:none">No Transaction Found</div>
							<div id="pieChartInsight" style="width:350px;height:350px;margin-top:-20px;margin-left:-15px;"></div>
						</div>
						<div style="display:none;text-align:center">
							<div class="chartEmpty" style="margin-top:10px;display:none">No Transaction Found</div>
							<div id="lineChart" style="width:310px;height:300px;margin-top:0x;margin-left:-5px"></div>
						</div>
						<div style="display:none;text-align:center; font-size:11px">
							<div data-role="collapsible-set" data-theme="c" data-content-theme="d" data-collapsed-icon="arrow-r" data-expanded-icon="arrow-d" data-inset="true" class="list" style="padding:10px 10px 0px 10px;">
							</div>
							
							<!--<a class="loadmore" href="#" >Load more... </a> -->

						</div>
					</div>
				</div>
		</div>
	</div>
		<!--page track -->


<!--Categories -->

		<div data-role="page" id="listCats">
			<div data-role="header" data-theme="b" style="height:30px;">

				<a data-icon="delete" data-inline="true"  data-mini="true" data-iconpos="notext" href="index.html" style="margin-top:-3px">Delete</a>
				<h1 style="margin-top:4px">All Categories</h1>

				
			</div>
			<!-- /header -->
			<div data-role="content">

				<ul id="allCatsList" data-role="listview" data-filter="true"  data-filter-placeholder="Search Categories.." data-inset="true">
			
				</ul>
			</div>
		</div> 


<!---categories -->

<!--login -->

		<div data-role="page" id="login">
			<div data-role="header" data-theme="b" style="height:30px;">

				<h1 style="margin-top:4px">Budgit</h1>

				
			</div>
			<!-- /header -->
			<div data-role="content">
				<div style="text-align:center">
    				<input type="text" name="email" id="email" value=""  placeholder="Email"/>
    				<input type="password" name="password" id="password" value=""  placeholder="Password"/>
					<a href="#register" style="float:left" class="navlink">Sign up</a>
					<a href="#forgotPassword" style="float:right" class="navlink">Forgot Password</a>

				</div>
			</div>
		</div> 

<!---login -->

<!--register -->

		<div data-role="page" id="register">
			<div data-role="header" data-theme="b" style="height:30px;">

				<h1 style="margin-top:4px">Sign up</h1>

				
			</div>
			<!-- /header -->
			<div data-role="content">
				<div style="text-align:center">
    				<input type="text" name="name" id="name" value=""  placeholder="Your Name"/>
    				<input type="text" name="email" id="email" value=""  placeholder="Your Email"/>
    		
    				<input type="password" name="password" id="password" value=""  placeholder="Password"/>
    				<a href="#next" data-role="button">Next</a>
				</div>
			</div>
		</div> 

<!---register -->





	<script src="js/sync.js" type="text/javascript"></script>	
	<script type="text/javascript" src="js/database.js"></script>
	<script src="js/mobiscroll.js" type="text/javascript"></script>
	
	<script src="js/jqmcharts/jquery.jqplot.min.js" type="text/javascript"></script>
	<script src="js/jqmcharts/jqplot.pointLabels.min.js" type="text/javascript"></script>
	<script src="js/jqmcharts/jqplot.barRenderer.min.js" type="text/javascript"></script>
	<script src="js/jqmcharts/jqplot.categoryAxisRenderer.min.js" type="text/javascript"></script>
	<script src="js/jqmcharts/jqplot.donutRenderer.min.js" type="text/javascript"></script>
	<script src="js/jqmcharts/jqplot.pieRenderer.min.js" type="text/javascript"></script>
	<script src="js/jqmcharts/jqplot.highlighter.min.js" type="text/javascript"></script>
	<script src="js/jqmcharts/jqplot.dateAxisRenderer.min.js" type="text/javascript"></script>

	<script type="text/javascript" src="js/jqmcharts/jqplot.canvasTextRenderer.min.js"></script>
	<script type="text/javascript" src="js/jqmcharts/jqplot.canvasAxisTickRenderer.min.js"></script>
	<script type="text/javascript" src="js/jqmcharts/jqplot.canvasOverlay.min.js"></script>

	
	<script src="js/cat.js" type="text/javascript"></script>
	<script src="js/barchart.js" type="text/javascript"></script>
	<script src="js/inputText.js" type="text/javascript"></script>
	<script src="js/webSqlSync.js" type="text/javascript"></script>

	<script src="js/login.js" type="text/javascript"></script>


<!-- -->
	</body>
</html>